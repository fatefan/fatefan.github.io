<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="RxJS"/>




  <meta name="keywords" content="RxJS, Fynn's Blog" />










  <link rel="alternate" href="/atom.xml" title="Fynn's Blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0" />



<link rel="canonical" href="https://fynn90.github.io/2021/03/03/RxJS/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  
  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?607980a031d3edcefed502ce80e77ffb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <script id="google_analytics">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-115728733-1', 'auto');
        ga('send', 'pageview');
  </script>


  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>





  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "jH321kB4p1r5FNrL8YBCwbrG-gzGzoHsz",
      appKey: "Q8vnaBtTzmVPbVX8tdzM7z7w"
    });
  </script>





    <title> RxJS - Fynn's Blog </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Fynn's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/categories/">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Fynn's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            
            
              分类
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          RxJS
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2021-03-03
        </span>
        
          <div class="post-category">
            
              <a href="/categories/RxJS/">RxJS</a>
            
          </div>
        
        
        <div class="post-visits"
             data-url="/2021/03/03/RxJS/"
             data-title="RxJS">
            阅读次数
          </div>
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#RxJS-例子-🌰"><span class="toc-text">RxJS 例子 🌰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#发布订阅-Observable-amp-subscribe"><span class="toc-text">发布订阅 Observable &amp; subscribe</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据流的处理-operators"><span class="toc-text">数据流的处理 operators</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Subject-监听多路事件和发布"><span class="toc-text">Subject 监听多路事件和发布</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RxJS-核心概念"><span class="toc-text">RxJS 核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Observable"><span class="toc-text">Observable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Observable-四个核心概念"><span class="toc-text">Observable 四个核心概念</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Observer"><span class="toc-text">Observer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#operators"><span class="toc-text">operators</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Piping"><span class="toc-text">Piping</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Creation-Operators"><span class="toc-text">Creation Operators</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#操作符分类"><span class="toc-text">操作符分类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#创建操作符"><span class="toc-text">创建操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#连接创建操作符"><span class="toc-text">连接创建操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#转换操作符"><span class="toc-text">转换操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#过滤操作符"><span class="toc-text">过滤操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#连接操作符"><span class="toc-text">连接操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#多广播操作符"><span class="toc-text">多广播操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#错误捕获操作符"><span class="toc-text">错误捕获操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#工具操作符"><span class="toc-text">工具操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#条件和布尔操作符"><span class="toc-text">条件和布尔操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#数学和聚合操作符"><span class="toc-text">数学和聚合操作符</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子-🌰"><span class="toc-text">例子 🌰</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Subscription"><span class="toc-text">Subscription</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Subject"><span class="toc-text">Subject</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#单播和多播"><span class="toc-text">单播和多播</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BehaviorSubject"><span class="toc-text">BehaviorSubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReplaySubject"><span class="toc-text">ReplaySubject</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AsyncSubject"><span class="toc-text">AsyncSubject</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Scheduler（调度器）"><span class="toc-text">Scheduler（调度器）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Schedulers-调度器-类型"><span class="toc-text">Schedulers(调度器) 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用-Schedulers-调度器"><span class="toc-text">使用 Schedulers(调度器)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RxJS-业务上的实践"><span class="toc-text">RxJS 业务上的实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#页面元素拖拽"><span class="toc-text">页面元素拖拽</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Refer-To"><span class="toc-text">Refer To</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p><img src="https://img.imgdb.cn/item/6030f4e25f4313ce259e4f45.png" alt=""></p>
<p><a href="https://rxjs.dev/guide/overview" target="_blank" rel="noopener">RxJS</a> 是 Javascript 世界中实现响应式编程工具库，它使得在 JS 中处理复杂的数据流变得简单和易于维护。</p>
<blockquote>
<p><strong>响应式编程</strong>或<strong>反应式编程</strong>（英语：Reactive programming）是一种面向数据<a href="https://zh.wikipedia.org/wiki/串流" target="_blank" rel="noopener">流</a>和变化传播的<a href="https://zh.wikipedia.org/wiki/声明式编程" target="_blank" rel="noopener">声明式</a><a href="https://zh.wikipedia.org/wiki/编程范式" target="_blank" rel="noopener">编程范式</a>。这意味着可以在编程语言中很方便地表达静态或动态的数据流，而相关的计算模型会自动将变化的值通过数据流进行传播。 - <a href="https://zh.wikipedia.org/wiki/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B" target="_blank" rel="noopener">wikipedia</a></p>
</blockquote>
<h2 id="RxJS-例子-🌰"><a href="#RxJS-例子-🌰" class="headerlink" title="RxJS 例子 🌰"></a>RxJS 例子 🌰</h2><h3 id="发布订阅-Observable-amp-subscribe"><a href="#发布订阅-Observable-amp-subscribe" class="headerlink" title="发布订阅 Observable &amp; subscribe"></a>发布订阅 <strong>Observable</strong> &amp; <strong>subscribe</strong></h3><p>RxJS 最核心的能力就是 软件设计中的 <a href="https://zh.wikipedia.org/zh-cn/%E5%8F%91%E5%B8%83/%E8%AE%A2%E9%98%85" target="_blank" rel="noopener">发布/订阅模式</a>. 它通过 <code>Observable</code>和<code>subscribe</code>实现</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="comment">// 记录时间</span></span><br><span class="line"><span class="keyword">const</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建流</span></span><br><span class="line"><span class="keyword">const</span> stream$ = <span class="keyword">new</span> Observable(<span class="function">(<span class="params">subscriber</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.next([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]); <span class="comment">// 发布</span></span><br><span class="line">  &#125;, <span class="number">500</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.next(&#123; a: <span class="number">1000</span> &#125;); <span class="comment">// 发布</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.next(<span class="string">'end'</span>); <span class="comment">// 发布</span></span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.complete(); <span class="comment">// 完成</span></span><br><span class="line">  &#125;, <span class="number">4000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动流。 订阅</span></span><br><span class="line"><span class="keyword">const</span> subscription1 = stream$.subscribe(&#123;</span><br><span class="line">  complete: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'done'</span>),</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - now, <span class="string">'ms stream1'</span>, v),</span><br><span class="line">  error: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'error'</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//  延时1s后，启动流</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> subscription2 = stream$.subscribe(&#123;</span><br><span class="line">    next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - now, <span class="string">'ms stream2'</span>, v),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p><strong>结果：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">502 ms stream1 [ 1, 2, 3 ]</span><br><span class="line">1008 ms stream1 &#123; a: 1000 &#125;</span><br><span class="line">1512 ms stream2 [ 1, 2, 3 ]</span><br><span class="line">2013 ms stream2 &#123; a: 1000 &#125;</span><br><span class="line">3006 ms stream1 end</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">4010 ms stream2 end</span><br></pre></td></tr></table></figure>
<h3 id="数据流的处理-operators"><a href="#数据流的处理-operators" class="headerlink" title="数据流的处理 operators"></a>数据流的处理 <strong>operators</strong></h3><p>RxJS 提供各种操作符(operators)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>RxJS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span>&gt;</span>按 钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcdn.net/ajax/libs/rxjs/6.6.3/rxjs.umd.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      let &#123; fromEvent &#125; = window.rxjs;</span></span><br><span class="line"><span class="undefined">      let &#123; throttleTime, scan &#125; = window.rxjs.operators;</span></span><br><span class="line"><span class="undefined">      let btn = document.getElementById('btn');</span></span><br><span class="line"><span class="undefined">      // fromEvent 创建一个 Observable</span></span><br><span class="line"><span class="undefined">      fromEvent(btn, 'click')</span></span><br><span class="line"><span class="undefined">        .pipe(</span></span><br><span class="line"><span class="undefined">          throttleTime(1000), // 防抖1秒钟</span></span><br><span class="line"><span class="undefined">          scan((count) =&gt; count + 1, 0) // 累积计算</span></span><br><span class="line"><span class="undefined">        )</span></span><br><span class="line"><span class="undefined">        .subscribe((count) =&gt; console.log(`click $&#123;count&#125; times`)); //订阅并且将处理后的数据传递给 subscribe</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Subject-监听多路事件和发布"><a href="#Subject-监听多路事件和发布" class="headerlink" title="Subject 监听多路事件和发布"></a>Subject 监听多路事件和发布</h3><p><code>Subject</code>类似于 <code>EventEmitter</code>可以将监听多个事件和广播事件触发。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Subject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建subject</span></span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅一个observer</span></span><br><span class="line">subject.subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'stream 1'</span>, v));</span><br><span class="line"><span class="comment">// 再订阅一个observer</span></span><br><span class="line">subject.subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'stream 2'</span>, v));</span><br><span class="line"><span class="comment">// 延时1s再订阅一个observer</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subject.subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'stream 3'</span>, v));</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">// 产生数据1</span></span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 产生数据2</span></span><br><span class="line">subject.next(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// 延时3s产生数据3</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subject.next(<span class="number">3</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="RxJS-核心概念"><a href="#RxJS-核心概念" class="headerlink" title="RxJS 核心概念"></a>RxJS 核心概念</h2><p>RxJS 结合了 观察者模式、迭代器模式、使用集合的函数编程，以满足一种理想方式来挂历事件序列所需要的一切。</p>
<p>RxJS 解决异步事件管理的基本概念：</p>
<ul>
<li><strong>Observable (可观察对象):</strong> 表示一个概念，这个概念是一个可调用的未来值或事件的集合。</li>
<li><strong>Observer (观察者):</strong> 一个回调函数的集合，它知道如何去监听由 Observable 提供的值。</li>
<li><strong>Subscription (订阅):</strong> 表示 Observable 的执行，主要用于取消 Observable 的执行。</li>
<li><strong>Operators (操作符):</strong> 采用函数式编程风格的纯函数 (pure function)，使用像 <code>map</code>、<code>filter</code>、<code>concat</code>、<code>flatMap</code> 等这样的操作符来处理集合。</li>
<li><strong>Subject (主体):</strong> 相当于 EventEmitter，并且是将值或事件多路推送给多个 Observer 的唯一方式。</li>
<li><strong>Schedulers (调度器):</strong> 用来控制并发并且是中央集权的调度员，允许我们在发生计算时进行协调，例如 <code>setTimeout</code> 或 <code>requestAnimationFrame</code> 或其他。</li>
</ul>
<h3 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a><a href="https://rxjs.dev/guide/observable" target="_blank" rel="noopener">Observable</a></h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">new</span> Observable(<span class="function">(<span class="params">subscriber</span>) =&gt;</span> &#123;</span><br><span class="line">  subscriber.next(<span class="number">1</span>);</span><br><span class="line">  subscriber.next(<span class="number">2</span>);</span><br><span class="line">  subscriber.next(<span class="number">3</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.next(<span class="number">4</span>);</span><br><span class="line">    subscriber.complete();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>Observable</code> 可以接受一个 <code>Function</code>用来发布数据。实例化<code>Observable</code>可以获得<code>observable</code>.它可以用来订阅<code>observable</code>，用来处理<code>Observable</code>发布的数据。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">new</span> Observable(<span class="function">(<span class="params">subscriber</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Hello'</span>);</span><br><span class="line">  subscriber.next(<span class="number">42</span>);</span><br><span class="line">  subscriber.next(<span class="number">100</span>);</span><br><span class="line">  subscriber.next(<span class="number">200</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscriber.next(<span class="number">300</span>); <span class="comment">// happens asynchronously</span></span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'before'</span>);</span><br><span class="line">observable.subscribe(<span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'after'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 输出</span></span><br><span class="line"><span class="comment">"before"</span></span><br><span class="line"><span class="comment">"Hello"</span></span><br><span class="line"><span class="comment">42</span></span><br><span class="line"><span class="comment">100</span></span><br><span class="line"><span class="comment">200</span></span><br><span class="line"><span class="comment">"after"</span></span><br><span class="line"><span class="comment">300</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><code>observable.subscribe</code>的调用可以获取到 <code>Observable</code>中推动的数据及时它是异步的。</p>
<h4 id="Observable-四个核心概念"><a href="#Observable-四个核心概念" class="headerlink" title="Observable 四个核心概念"></a>Observable 四个核心概念</h4><ul>
<li>创建 Observables - <code>const observable = new Observable(subscriber =&gt; {...});</code></li>
<li>订阅 Observables - <code>observable.subscribe(...)</code></li>
<li>执行 Observables - <code>new Observable(function subscribe(subscriber) {...})</code> 中 <code>subscriber</code>支持<code>next\error\complete</code>三种类型执行方式</li>
<li>清理 Observables - <code>observable.subscribe(...)</code> 执行后获取一个<code>Subscription</code>,可以用它清理掉<code>Observable</code> <code>subscription.unsubscribe()</code></li>
</ul>
<p>除了用<code>new Observable</code>可以创建<code>observable</code>之外，Rxjs 也提供了其它创建<code>observable</code>的方式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">from</span> &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">from</span>([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>]);</span><br><span class="line"><span class="keyword">const</span> subscription = observable.subscribe(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="built_in">console</span>.log(x));</span><br><span class="line"><span class="comment">// Later:</span></span><br><span class="line">subscription.unsubscribe();</span><br></pre></td></tr></table></figure>
<h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a><a href="https://rxjs.dev/guide/observer" target="_blank" rel="noopener">Observer</a></h3><p><code>Observer</code>是<code>Observable</code>发送值的消费方。<code>Observer</code>有三种形式：一个函数，一个<code>{next:Function,error:Function,complete:Function}</code>的对象，传递三个函数作为参数，参数顺序是：<code>next、error、complete</code>。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 流</span></span><br><span class="line"><span class="keyword">const</span> Stream$ = <span class="keyword">new</span> Observable(<span class="function">(<span class="params">subscribe</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// subscribe除了 next方法可以调用，也还可以调用 complete,error方法。</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    subscribe.next([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line">  &#125;);</span><br><span class="line">  subscribe.next(&#123; a: <span class="number">100</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obsever1 = &#123;</span><br><span class="line">  complete: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'obsever1 - done'</span>),</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'obsever1'</span>, v),</span><br><span class="line">  error: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.error(<span class="string">'obsever1'</span>, <span class="string">'error'</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启动流</span></span><br><span class="line"><span class="keyword">const</span> Subscription1 = Stream$.subscribe(obsever);</span><br><span class="line"><span class="keyword">const</span> Subscription2 = Stream$.subscribe(<span class="function"><span class="keyword">function</span> <span class="title">observer2</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'obsever2'</span>, v);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Subscription2 = Stream$.subscribe(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">observer3_next</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'obsever2'</span>, v);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">observer3_error</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'obsever2'</span>, v);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">observer3_complete</span>(<span class="params">v</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'obsever3 - done'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>next\error\complete</code>并不需要全部定义，可以定义一部分。</p>
<h3 id="operators"><a href="#operators" class="headerlink" title="operators"></a><a href="https://rxjs.dev/guide/operators" target="_blank" rel="noopener">operators</a></h3><p>尽管 RxJS 的根基是 Observable，但最有用的还是它的<strong>操作符</strong>。操作符是允许复杂的异步代码以声明式的方式进行轻松组合的基础代码单元。</p>
<p>operators 操作符就是一个函数，它有两种类型：</p>
<ul>
<li><p><strong>Pipeable Operators</strong> （管道操作符）： <code>observable</code>实例可以使用这样的语法:<code>observableInstance.pipe(operator())</code> 传递一个<code>Observable</code>并返回一个新的<code>Observable</code>。</p>
<p>操作符本质上是一个纯函数 (pure function)，它接收一个 Observable 作为输入，并生成一个新的 Observable 作为输出。订阅输出 Observable 同样会订阅输入 Observable 。</p>
</li>
<li><p><strong>Creation Operators</strong> （创造操作符）：可以称为独立函数来创建新的 Observable。</p>
</li>
</ul>
<h4 id="Piping"><a href="#Piping" class="headerlink" title="Piping"></a>Piping</h4><p>Pipeable Operators 是无害的纯函数，借助<code>pipe()</code>可以实现，多个管道操作符串行处理。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">obs.pipe(op1(), op2(), op3(), op3());</span><br></pre></td></tr></table></figure>
<p>你可以通过<code>op()(obs)</code>使用管道运算符，但并不推荐这样使用，因为可读性不好：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; of &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; map &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// op()(obs) 模式</span></span><br><span class="line"><span class="comment">// map是管道操作符。 of返回一个 observable</span></span><br><span class="line">map(<span class="function">(<span class="params">x: <span class="built_in">number</span></span>) =&gt;</span> x * x)(of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)).subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`value1: <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// obs.pipe( op1(),op2(),op3(),op3()) 模式</span></span><br><span class="line">of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">  .pipe(map(<span class="function">(<span class="params">v</span>) =&gt;</span> v + v))</span><br><span class="line">  .subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`value2: <span class="subst">$&#123;v&#125;</span>`</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 输出</span></span><br><span class="line"><span class="comment">value1: 1</span></span><br><span class="line"><span class="comment">value1: 4</span></span><br><span class="line"><span class="comment">value1: 9</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">value2: 2</span></span><br><span class="line"><span class="comment">value2: 4</span></span><br><span class="line"><span class="comment">value2: 6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="Creation-Operators"><a href="#Creation-Operators" class="headerlink" title="Creation Operators"></a>Creation Operators</h4><p>什么是创作运算符？与管道运算符不同，创建运算符是可用于创建<code>Observable</code>对象的函数.具有一些常见的预定义行为或通过加入其他 Observable.</p>
<p>创建运算符的典型示例是间隔函数。它以数字（不是 Observable）作为输入参数，并产生 Observable 作为输出：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; interval &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = interval(<span class="number">1000</span> <span class="comment">/* number of milliseconds */</span>);</span><br></pre></td></tr></table></figure>
<h4 id="操作符分类"><a href="#操作符分类" class="headerlink" title="操作符分类"></a>操作符分类</h4><p>操作符有着不同的用途，它们可作如下分类：创建、转换、过滤、组合、错误处理、工具，等等。在下面的列表中，你可以按分类组织好的所有操作符。</p>
<h5 id="创建操作符"><a href="#创建操作符" class="headerlink" title="创建操作符"></a>创建操作符</h5><ul>
<li><a href="https://rxjs.dev/api/ajax/ajax" target="_blank" rel="noopener"><code>ajax</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/bindCallback" target="_blank" rel="noopener"><code>bindCallback</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/bindNodeCallback" target="_blank" rel="noopener"><code>bindNodeCallback</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/defer" target="_blank" rel="noopener"><code>defer</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/empty" target="_blank" rel="noopener"><code>empty</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/from" target="_blank" rel="noopener"><code>from</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/fromEvent" target="_blank" rel="noopener"><code>fromEvent</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/fromEventPattern" target="_blank" rel="noopener"><code>fromEventPattern</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/generate" target="_blank" rel="noopener"><code>generate</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/interval" target="_blank" rel="noopener"><code>interval</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/of" target="_blank" rel="noopener"><code>of</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/range" target="_blank" rel="noopener"><code>range</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/throwError" target="_blank" rel="noopener"><code>throwError</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/timer" target="_blank" rel="noopener"><code>timer</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/iif" target="_blank" rel="noopener"><code>iif</code></a></li>
</ul>
<h5 id="连接创建操作符"><a href="#连接创建操作符" class="headerlink" title="连接创建操作符"></a>连接创建操作符</h5><p>这些是 Observable 创建运算符，还具有联接功能-发出多个源 Observable 的值。</p>
<ul>
<li><a href="https://rxjs.dev/api/index/function/combineLatest" target="_blank" rel="noopener"><code>combineLatest</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/concat" target="_blank" rel="noopener"><code>concat</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/forkJoin" target="_blank" rel="noopener"><code>forkJoin</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/merge" target="_blank" rel="noopener"><code>merge</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/partition" target="_blank" rel="noopener"><code>partition</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/race" target="_blank" rel="noopener"><code>race</code></a></li>
<li><a href="https://rxjs.dev/api/index/function/zip" target="_blank" rel="noopener"><code>zip</code></a></li>
</ul>
<h5 id="转换操作符"><a href="#转换操作符" class="headerlink" title="转换操作符"></a>转换操作符</h5><ul>
<li><a href="https://rxjs.dev/api/operators/buffer" target="_blank" rel="noopener"><code>buffer</code></a></li>
<li><a href="https://rxjs.dev/api/operators/bufferCount" target="_blank" rel="noopener"><code>bufferCount</code></a></li>
<li><a href="https://rxjs.dev/api/operators/bufferTime" target="_blank" rel="noopener"><code>bufferTime</code></a></li>
<li><a href="https://rxjs.dev/api/operators/bufferToggle" target="_blank" rel="noopener"><code>bufferToggle</code></a></li>
<li><a href="https://rxjs.dev/api/operators/bufferWhen" target="_blank" rel="noopener"><code>bufferWhen</code></a></li>
<li><a href="https://rxjs.dev/api/operators/concatMap" target="_blank" rel="noopener"><code>concatMap</code></a></li>
<li><a href="https://rxjs.dev/api/operators/concatMapTo" target="_blank" rel="noopener"><code>concatMapTo</code></a></li>
<li><a href="https://rxjs.dev/api/operators/exhaust" target="_blank" rel="noopener"><code>exhaust</code></a></li>
<li><a href="https://rxjs.dev/api/operators/exhaustMap" target="_blank" rel="noopener"><code>exhaustMap</code></a></li>
<li><a href="https://rxjs.dev/api/operators/expand" target="_blank" rel="noopener"><code>expand</code></a></li>
<li><a href="https://rxjs.dev/api/operators/groupBy" target="_blank" rel="noopener"><code>groupBy</code></a></li>
<li><a href="https://rxjs.dev/api/operators/map" target="_blank" rel="noopener"><code>map</code></a></li>
<li><a href="https://rxjs.dev/api/operators/mapTo" target="_blank" rel="noopener"><code>mapTo</code></a></li>
<li><a href="https://rxjs.dev/api/operators/mergeMap" target="_blank" rel="noopener"><code>mergeMap</code></a></li>
<li><a href="https://rxjs.dev/api/operators/mergeMapTo" target="_blank" rel="noopener"><code>mergeMapTo</code></a></li>
<li><a href="https://rxjs.dev/api/operators/mergeScan" target="_blank" rel="noopener"><code>mergeScan</code></a></li>
<li><a href="https://rxjs.dev/api/operators/pairwise" target="_blank" rel="noopener"><code>pairwise</code></a></li>
<li><a href="https://rxjs.dev/api/operators/partition" target="_blank" rel="noopener"><code>partition</code></a></li>
<li><a href="https://rxjs.dev/api/operators/pluck" target="_blank" rel="noopener"><code>pluck</code></a></li>
<li><a href="https://rxjs.dev/api/operators/scan" target="_blank" rel="noopener"><code>scan</code></a></li>
<li><a href="https://rxjs.dev/api/operators/switchMap" target="_blank" rel="noopener"><code>switchMap</code></a></li>
<li><a href="https://rxjs.dev/api/operators/switchMapTo" target="_blank" rel="noopener"><code>switchMapTo</code></a></li>
<li><a href="https://rxjs.dev/api/operators/window" target="_blank" rel="noopener"><code>window</code></a></li>
<li><a href="https://rxjs.dev/api/operators/windowCount" target="_blank" rel="noopener"><code>windowCount</code></a></li>
<li><a href="https://rxjs.dev/api/operators/windowTime" target="_blank" rel="noopener"><code>windowTime</code></a></li>
<li><a href="https://rxjs.dev/api/operators/windowToggle" target="_blank" rel="noopener"><code>windowToggle</code></a></li>
<li><a href="https://rxjs.dev/api/operators/windowWhen" target="_blank" rel="noopener"><code>windowWhen</code></a></li>
</ul>
<h5 id="过滤操作符"><a href="#过滤操作符" class="headerlink" title="过滤操作符"></a>过滤操作符</h5><ul>
<li><a href="https://rxjs.dev/api/operators/audit" target="_blank" rel="noopener"><code>audit</code></a></li>
<li><a href="https://rxjs.dev/api/operators/auditTime" target="_blank" rel="noopener"><code>auditTime</code></a></li>
<li><a href="https://rxjs.dev/api/operators/debounce" target="_blank" rel="noopener"><code>debounce</code></a></li>
<li><a href="https://rxjs.dev/api/operators/debounceTime" target="_blank" rel="noopener"><code>debounceTime</code></a></li>
<li><a href="https://rxjs.dev/api/operators/distinct" target="_blank" rel="noopener"><code>distinct</code></a></li>
<li><a href="https://rxjs.dev/class/es6/Observable.js~Observable.html#instance-method-distinctKey" target="_blank" rel="noopener"><code>distinctKey</code></a></li>
<li><a href="https://rxjs.dev/api/operators/distinctUntilChanged" target="_blank" rel="noopener"><code>distinctUntilChanged</code></a></li>
<li><a href="https://rxjs.dev/api/operators/distinctUntilKeyChanged" target="_blank" rel="noopener"><code>distinctUntilKeyChanged</code></a></li>
<li><a href="https://rxjs.dev/api/operators/elementAt" target="_blank" rel="noopener"><code>elementAt</code></a></li>
<li><a href="https://rxjs.dev/api/operators/filter" target="_blank" rel="noopener"><code>filter</code></a></li>
<li><a href="https://rxjs.dev/api/operators/first" target="_blank" rel="noopener"><code>first</code></a></li>
<li><a href="https://rxjs.dev/api/operators/ignoreElements" target="_blank" rel="noopener"><code>ignoreElements</code></a></li>
<li><a href="https://rxjs.dev/api/operators/last" target="_blank" rel="noopener"><code>last</code></a></li>
<li><a href="https://rxjs.dev/api/operators/sample" target="_blank" rel="noopener"><code>sample</code></a></li>
<li><a href="https://rxjs.dev/api/operators/sampleTime" target="_blank" rel="noopener"><code>sampleTime</code></a></li>
<li><a href="https://rxjs.dev/api/operators/single" target="_blank" rel="noopener"><code>single</code></a></li>
<li><a href="https://rxjs.dev/api/operators/skip" target="_blank" rel="noopener"><code>skip</code></a></li>
<li><a href="https://rxjs.dev/api/operators/skipLast" target="_blank" rel="noopener"><code>skipLast</code></a></li>
<li><a href="https://rxjs.dev/api/operators/skipUntil" target="_blank" rel="noopener"><code>skipUntil</code></a></li>
<li><a href="https://rxjs.dev/api/operators/skipWhile" target="_blank" rel="noopener"><code>skipWhile</code></a></li>
<li><a href="https://rxjs.dev/api/operators/take" target="_blank" rel="noopener"><code>take</code></a></li>
<li><a href="https://rxjs.dev/api/operators/takeLast" target="_blank" rel="noopener"><code>takeLast</code></a></li>
<li><a href="https://rxjs.dev/api/operators/takeUntil" target="_blank" rel="noopener"><code>takeUntil</code></a></li>
<li><a href="https://rxjs.dev/api/operators/takeWhile" target="_blank" rel="noopener"><code>takeWhile</code></a></li>
<li><a href="https://rxjs.dev/api/operators/throttle" target="_blank" rel="noopener"><code>throttle</code></a></li>
<li><a href="https://rxjs.dev/api/operators/throttleTime" target="_blank" rel="noopener"><code>throttleTime</code></a></li>
</ul>
<h5 id="连接操作符"><a href="#连接操作符" class="headerlink" title="连接操作符"></a>连接操作符</h5><ul>
<li><a href="https://rxjs.dev/api/operators/combineAll" target="_blank" rel="noopener"><code>combineAll</code></a></li>
<li><a href="https://rxjs.dev/api/operators/concatAll" target="_blank" rel="noopener"><code>concatAll</code></a></li>
<li><a href="https://rxjs.dev/api/operators/exhaust" target="_blank" rel="noopener"><code>exhaust</code></a></li>
<li><a href="https://rxjs.dev/api/operators/mergeAll" target="_blank" rel="noopener"><code>mergeAll</code></a></li>
<li><a href="https://rxjs.dev/api/operators/startWith" target="_blank" rel="noopener"><code>startWith</code></a></li>
<li><a href="https://rxjs.dev/api/operators/withLatestFrom" target="_blank" rel="noopener"><code>withLatestFrom</code></a></li>
</ul>
<h5 id="多广播操作符"><a href="#多广播操作符" class="headerlink" title="多广播操作符"></a>多广播操作符</h5><ul>
<li><a href="https://rxjs.dev/api/operators/multicast" target="_blank" rel="noopener"><code>multicast</code></a></li>
<li><a href="https://rxjs.dev/api/operators/publish" target="_blank" rel="noopener"><code>publish</code></a></li>
<li><a href="https://rxjs.dev/api/operators/publishBehavior" target="_blank" rel="noopener"><code>publishBehavior</code></a></li>
<li><a href="https://rxjs.dev/api/operators/publishLast" target="_blank" rel="noopener"><code>publishLast</code></a></li>
<li><a href="https://rxjs.dev/api/operators/publishReplay" target="_blank" rel="noopener"><code>publishReplay</code></a></li>
<li><a href="https://rxjs.dev/api/operators/share" target="_blank" rel="noopener"><code>share</code></a></li>
</ul>
<h5 id="错误捕获操作符"><a href="#错误捕获操作符" class="headerlink" title="错误捕获操作符"></a>错误捕获操作符</h5><ul>
<li><a href="https://rxjs.dev/api/operators/catchError" target="_blank" rel="noopener"><code>catchError</code></a></li>
<li><a href="https://rxjs.dev/api/operators/retry" target="_blank" rel="noopener"><code>retry</code></a></li>
<li><a href="https://rxjs.dev/api/operators/retryWhen" target="_blank" rel="noopener"><code>retryWhen</code></a></li>
</ul>
<h5 id="工具操作符"><a href="#工具操作符" class="headerlink" title="工具操作符"></a>工具操作符</h5><ul>
<li><a href="https://rxjs.dev/api/operators/tap" target="_blank" rel="noopener"><code>tap</code></a></li>
<li><a href="https://rxjs.dev/api/operators/delay" target="_blank" rel="noopener"><code>delay</code></a></li>
<li><a href="https://rxjs.dev/api/operators/delayWhen" target="_blank" rel="noopener"><code>delayWhen</code></a></li>
<li><a href="https://rxjs.dev/api/operators/dematerialize" target="_blank" rel="noopener"><code>dematerialize</code></a></li>
<li><a href="https://rxjs.dev/api/operators/materialize" target="_blank" rel="noopener"><code>materialize</code></a></li>
<li><a href="https://rxjs.dev/api/operators/observeOn" target="_blank" rel="noopener"><code>observeOn</code></a></li>
<li><a href="https://rxjs.dev/api/operators/subscribeOn" target="_blank" rel="noopener"><code>subscribeOn</code></a></li>
<li><a href="https://rxjs.dev/api/operators/timeInterval" target="_blank" rel="noopener"><code>timeInterval</code></a></li>
<li><a href="https://rxjs.dev/api/operators/timestamp" target="_blank" rel="noopener"><code>timestamp</code></a></li>
<li><a href="https://rxjs.dev/api/operators/timeout" target="_blank" rel="noopener"><code>timeout</code></a></li>
<li><a href="https://rxjs.dev/api/operators/timeoutWith" target="_blank" rel="noopener"><code>timeoutWith</code></a></li>
<li><a href="https://rxjs.dev/api/operators/toArray" target="_blank" rel="noopener"><code>toArray</code></a></li>
</ul>
<h5 id="条件和布尔操作符"><a href="#条件和布尔操作符" class="headerlink" title="条件和布尔操作符"></a>条件和布尔操作符</h5><ul>
<li><a href="https://rxjs.dev/api/operators/defaultIfEmpty" target="_blank" rel="noopener"><code>defaultIfEmpty</code></a></li>
<li><a href="https://rxjs.dev/api/operators/every" target="_blank" rel="noopener"><code>every</code></a></li>
<li><a href="https://rxjs.dev/api/operators/find" target="_blank" rel="noopener"><code>find</code></a></li>
<li><a href="https://rxjs.dev/api/operators/findIndex" target="_blank" rel="noopener"><code>findIndex</code></a></li>
<li><a href="https://rxjs.dev/api/operators/isEmpty" target="_blank" rel="noopener"><code>isEmpty</code></a></li>
</ul>
<h5 id="数学和聚合操作符"><a href="#数学和聚合操作符" class="headerlink" title="数学和聚合操作符"></a>数学和聚合操作符</h5><ul>
<li><a href="https://rxjs.dev/api/operators/count" target="_blank" rel="noopener"><code>count</code></a></li>
<li><a href="https://rxjs.dev/api/operators/max" target="_blank" rel="noopener"><code>max</code></a></li>
<li><a href="https://rxjs.dev/api/operators/min" target="_blank" rel="noopener"><code>min</code></a></li>
<li><a href="https://rxjs.dev/api/operators/reduce" target="_blank" rel="noopener"><code>reduce</code></a></li>
</ul>
<h4 id="例子-🌰"><a href="#例子-🌰" class="headerlink" title="例子 🌰"></a>例子 🌰</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>RxJS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>click count: <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"count"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button-plus"</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"button-minus"</span>&gt;</span>-1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcdn.net/ajax/libs/rxjs/6.6.3/rxjs.umd.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      let &#123; fromEvent, operators &#125; = window.rxjs;</span></span><br><span class="line"><span class="undefined">      let &#123; mapTo, scan, merge &#125; = window.rxjs.operators;</span></span><br><span class="line"><span class="undefined">      console.log('operators:', operators);</span></span><br><span class="line"><span class="undefined">      console.log('window.rxjs:', window.rxjs);</span></span><br><span class="line"><span class="undefined">      fromEvent(document.getElementById('button-plus'), 'click')</span></span><br><span class="line"><span class="undefined">        .pipe(</span></span><br><span class="line"><span class="undefined">          mapTo(1),</span></span><br><span class="line"><span class="undefined">          merge(</span></span><br><span class="line"><span class="undefined">            fromEvent(document.getElementById('button-minus'), 'click').pipe(</span></span><br><span class="line"><span class="undefined">              mapTo(-1)</span></span><br><span class="line"><span class="undefined">            )</span></span><br><span class="line"><span class="undefined">          ),</span></span><br><span class="line"><span class="undefined">          scan((total, now) =&gt; total + now)</span></span><br><span class="line"><span class="undefined">        )</span></span><br><span class="line"><span class="undefined">        .subscribe((value) =&gt; &#123;</span></span><br><span class="line"><span class="undefined">          document.getElementById('count').innerText = value;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Subscription"><a href="#Subscription" class="headerlink" title="Subscription"></a><a href="https://rxjs.dev/guide/subscription" target="_blank" rel="noopener">Subscription</a></h3><p><code>Subscription</code> - 是代表一次性资源的对象，通常是<code>Observable</code>的执行。<code>Subscription</code>拥有一种重要的方法<code>unsubscribe()</code>，即取消订阅，该方法不带任何参数，而只是处置该订阅所拥有的资源。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; interval &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = interval(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">const</span> subscription = observable.subscribe(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="built_in">console</span>.log(x));</span><br><span class="line"><span class="comment">// Later:</span></span><br><span class="line"><span class="comment">// This cancels the ongoing Observable execution which</span></span><br><span class="line"><span class="comment">// was started by calling subscribe with an Observer.</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscription.unsubscribe();</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 输出</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>Subscription 还可以合在一起，这样一个 Subscription 调用 <code>unsubscribe()</code> 方法，可能会有多个 Subscription 取消订阅 。你可以通过把一个 Subscription 添加到另一个上面来做这件事：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; interval &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable1 = interval(<span class="number">200</span>);</span><br><span class="line"><span class="keyword">const</span> observable2 = interval(<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subscription = observable1.subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`observable1 <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> childSubscription = observable2.subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`observable2 <span class="subst">$&#123;v&#125;</span>`</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">subscription.add(childSubscription);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subscription.unsubscribe();</span><br><span class="line">&#125;, <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 输出</span></span><br><span class="line"><span class="comment">observable1 0</span></span><br><span class="line"><span class="comment">observable2 0</span></span><br><span class="line"><span class="comment">observable1 1</span></span><br><span class="line"><span class="comment">observable1 2</span></span><br><span class="line"><span class="comment">observable2 1</span></span><br><span class="line"><span class="comment">observable1 3</span></span><br><span class="line"><span class="comment">observable2 2</span></span><br><span class="line"><span class="comment">observable1 4</span></span><br><span class="line"><span class="comment">observable2 3</span></span><br><span class="line"><span class="comment">observable1 5</span></span><br><span class="line"><span class="comment">observable1 6</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="Subject"><a href="#Subject" class="headerlink" title="Subject"></a><a href="https://rxjs.dev/guide/subject" target="_blank" rel="noopener">Subject</a></h3><p><code>Subject</code> 是一种特殊类型的<code>Observable</code>,它允许将值多播给多个观察者，所以 <code>Subject</code> 是多播的，而普通的 <code>Observables</code> 是单播的(每个已订阅的观察者都拥有 <code>Observable</code> 的独立执行)。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Subject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建subject</span></span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 订阅一个observer</span></span><br><span class="line">subject.subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'stream 1'</span>, v));</span><br><span class="line"><span class="comment">// 再订阅一个observer</span></span><br><span class="line">subject.subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'stream 2'</span>, v));</span><br><span class="line"><span class="comment">// 延时1s再订阅一个observer</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subject.subscribe(<span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'stream 3'</span>, v));</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">// 产生数据1</span></span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 产生数据2</span></span><br><span class="line">subject.next(<span class="number">2</span>);</span><br><span class="line"><span class="comment">// 延时3s产生数据3</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subject.next(<span class="number">3</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">stream 1 1</span></span><br><span class="line"><span class="comment">stream 2 1</span></span><br><span class="line"><span class="comment">stream 1 2</span></span><br><span class="line"><span class="comment">stream 2 2</span></span><br><span class="line"><span class="comment">stream 1 3</span></span><br><span class="line"><span class="comment">stream 2 3</span></span><br><span class="line"><span class="comment">stream 3 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="单播和多播"><a href="#单播和多播" class="headerlink" title="单播和多播"></a><a href="https://www.jianshu.com/p/765d572b26f0" target="_blank" rel="noopener">单播和多播</a></h4><p><strong>单播：</strong> 每个普通的 Observables 实例都只能被一个观察者订阅，当它被其他观察者订阅的时候会产生一个新的实例。也就是普通 Observables 被不同的观察者订阅的时候，会有多个实例，不管观察者是从何时开始订阅，每个实例都是从头开始把值发给对应的观察者</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Observable是单播，每一个订阅是独立</span></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">new</span> Observable(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">  observer.next(<span class="built_in">Math</span>.random());</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> observer.next(<span class="built_in">Math</span>.random()), <span class="number">300</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observable.subscribe(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`订阅1: <span class="subst">$&#123;val&#125;</span>`</span>));</span><br><span class="line"></span><br><span class="line">observable.subscribe(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`订阅2: <span class="subst">$&#123;val&#125;</span>`</span>));</span><br><span class="line"></span><br><span class="line">setTimeout(</span><br><span class="line">  () =&gt; observable.subscribe(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`订阅3:<span class="subst">$&#123;val&#125;</span>`</span>)),</span><br><span class="line">  <span class="number">500</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">订阅1: 0.6689612996581182</span></span><br><span class="line"><span class="comment">订阅2: 0.28043048188854236</span></span><br><span class="line"><span class="comment">订阅1: 0.1297750238807054</span></span><br><span class="line"><span class="comment">订阅2: 0.17389658580744594</span></span><br><span class="line"><span class="comment">订阅3:0.6927734300935287</span></span><br><span class="line"><span class="comment">订阅3:0.39659821631152314</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>多播：</strong> <code>Subject</code>是多播，则多个订阅都是一个实例。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Subject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> Subject();</span><br><span class="line"></span><br><span class="line">subject.subscribe(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`订阅1: <span class="subst">$&#123;val&#125;</span>`</span>));</span><br><span class="line">subject.subscribe(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`订阅2: <span class="subst">$&#123;val&#125;</span>`</span>));</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subject.subscribe(<span class="function">(<span class="params">val</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`订阅3: <span class="subst">$&#123;val&#125;</span>`</span>));</span><br><span class="line">&#125;, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="built_in">Math</span>.random());</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subject.next(<span class="built_in">Math</span>.random());</span><br><span class="line">&#125;, <span class="number">300</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">订阅1: 0.05834565385958235</span></span><br><span class="line"><span class="comment">订阅2: 0.05834565385958235</span></span><br><span class="line"><span class="comment">订阅1: 0.7996036293548809</span></span><br><span class="line"><span class="comment">订阅2: 0.7996036293548809</span></span><br><span class="line"><span class="comment">订阅3: 0.7996036293548809</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>每个 Subject 都是 Observable 。</strong> - 对于 Subject，你可以提供一个观察者并使用 <code>subscribe</code> 方法，就可以开始正常接收值。从观察者的角度而言，它无法判断 Observable 执行是来自普通的 Observable 还是 Subject 。</p>
<p>在 Subject 的内部，<code>subscribe</code> 不会调用发送值的新执行。它只是将给定的观察者注册到观察者列表中，类似于其他库或语言中的 <code>addListener</code> 的工作方式。</p>
<p><strong>每个 Subject 都是 Observer。</strong> - Subject 是一个有如下方法的对象： <code>next(v)</code>、<code>error(e)</code> 和 <code>complete()</code> 。要给 Subject 提供新值，只要调用 <code>next(theValue)</code>，它会将值多播给已注册监听该 Subject 的观察者们。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Rx.Subject();</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerA: '</span> + v),</span><br><span class="line">&#125;);</span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerB: '</span> + v),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line">subject.next(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>因为 Subject 是观察者，这也就在意味着你可以把 Subject 作为参数传给任何 Observable 的 <code>subscribe</code> 方法，如下面的示例所展示的：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">from</span>, Subject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Subject$ = <span class="keyword">new</span> Subject();</span><br><span class="line"></span><br><span class="line">Subject$.subscribe(&#123; next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerA: '</span> + v) &#125;);</span><br><span class="line">Subject$.subscribe(&#123; next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'observerB: '</span> + v) &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">from</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]);</span><br><span class="line">observable.subscribe(Subject$);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**输出</span></span><br><span class="line"><span class="comment">observerA: 1</span></span><br><span class="line"><span class="comment">observerB: 1</span></span><br><span class="line"><span class="comment">observerA: 2</span></span><br><span class="line"><span class="comment">observerB: 2</span></span><br><span class="line"><span class="comment">observerA: 3</span></span><br><span class="line"><span class="comment">observerB: 3</span></span><br><span class="line"><span class="comment">observerA: 4</span></span><br><span class="line"><span class="comment">observerB: 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>还有一些特殊类型的 <code>Subject</code>：<code>BehaviorSubject</code>、<code>ReplaySubject</code> 和 <code>AsyncSubject</code>。</p>
<h4 id="BehaviorSubject"><a href="#BehaviorSubject" class="headerlink" title="BehaviorSubject"></a>BehaviorSubject</h4><p>Subject 的其中一个变体就是 <code>BehaviorSubject</code>，它有一个“当前值”的概念。它保存了发送给消费者的最新值。并且当有新的观察者订阅时，会立即从 <code>BehaviorSubject</code> 那接收到“当前值”。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BehaviorSubject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> BehaviorSubject(<span class="number">0</span>); <span class="comment">// 0 is the initial value</span></span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line">subject.next(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">3</span>);</span><br><span class="line"><span class="comment">/** 输出</span></span><br><span class="line"><span class="comment">observerA: 0</span></span><br><span class="line"><span class="comment">observerA: 1</span></span><br><span class="line"><span class="comment">observerA: 2</span></span><br><span class="line"><span class="comment">observerB: 2</span></span><br><span class="line"><span class="comment">observerA: 3</span></span><br><span class="line"><span class="comment">observerB: 3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h4><p><code>ReplaySubject</code> 类似于 <code>BehaviorSubject</code>，它可以发送旧值给新的订阅者，但它还可以<em>记录</em> Observable 执行的一部分。</p>
<blockquote>
<p><code>ReplaySubject</code> 记录 Observable 执行中的多个值并将其回放给新的订阅者。</p>
</blockquote>
<p>当创建 <code>ReplaySubject</code> 时，你可以指定回放多少个值：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ReplaySubject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> ReplaySubject(<span class="number">3</span>); <span class="comment">// buffer 3 values for new subscribers</span></span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line">subject.next(<span class="number">2</span>);</span><br><span class="line">subject.next(<span class="number">3</span>);</span><br><span class="line">subject.next(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Logs:</span></span><br><span class="line"><span class="comment">// observerA: 1</span></span><br><span class="line"><span class="comment">// observerA: 2</span></span><br><span class="line"><span class="comment">// observerA: 3</span></span><br><span class="line"><span class="comment">// observerA: 4</span></span><br><span class="line"><span class="comment">// observerB: 2</span></span><br><span class="line"><span class="comment">// observerB: 3</span></span><br><span class="line"><span class="comment">// observerB: 4</span></span><br><span class="line"><span class="comment">// observerA: 5</span></span><br><span class="line"><span class="comment">// observerB: 5</span></span><br></pre></td></tr></table></figure>
<p>除了缓冲数量，你还可以指定 <em>window time</em> (以毫秒为单位)来确定多久之前的值可以记录。在下面的示例中，我们使用了较大的缓存数量<code>100</code>，但 window time 参数只设置了<code>500</code>毫秒。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ReplaySubject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> ReplaySubject(<span class="number">100</span>, <span class="number">500</span> <span class="comment">/* windowTime */</span>);</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="number">1</span>;</span><br><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> subject.next(i++), <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  subject.subscribe(&#123;</span><br><span class="line">    next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Logs</span></span><br><span class="line"><span class="comment">// observerA: 1</span></span><br><span class="line"><span class="comment">// observerA: 2</span></span><br><span class="line"><span class="comment">// observerA: 3</span></span><br><span class="line"><span class="comment">// observerA: 4</span></span><br><span class="line"><span class="comment">// observerA: 5</span></span><br><span class="line"><span class="comment">// observerB: 3</span></span><br><span class="line"><span class="comment">// observerB: 4</span></span><br><span class="line"><span class="comment">// observerB: 5</span></span><br><span class="line"><span class="comment">// observerA: 6</span></span><br><span class="line"><span class="comment">// observerB: 6</span></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<h4 id="AsyncSubject"><a href="#AsyncSubject" class="headerlink" title="AsyncSubject"></a>AsyncSubject</h4><p>AsyncSubject 是另一个 Subject 变体，只有当 Observable 执行完成时(执行 <code>complete()</code>)，它才会将执行的最后一个值发送给观察者。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; AsyncSubject &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">const</span> subject = <span class="keyword">new</span> AsyncSubject();</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerA: <span class="subst">$&#123;v&#125;</span>`</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">1</span>);</span><br><span class="line">subject.next(<span class="number">2</span>);</span><br><span class="line">subject.next(<span class="number">3</span>);</span><br><span class="line">subject.next(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">subject.subscribe(&#123;</span><br><span class="line">  next: <span class="function">(<span class="params">v</span>) =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`observerB: <span class="subst">$&#123;v&#125;</span>`</span>),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">subject.next(<span class="number">5</span>);</span><br><span class="line">subject.complete();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Logs:</span></span><br><span class="line"><span class="comment">// observerA: 5</span></span><br><span class="line"><span class="comment">// observerB: 5</span></span><br></pre></td></tr></table></figure>
<p>AsyncSubject 和 <a href="https://cn.rx.js.org/class/es6/Observable.js~Observable.html#instance-method-last" target="_blank" rel="noopener"><code>last()</code></a> 操作符类似，因为它也是等待 <code>complete</code> 通知，以发送一个单个值。</p>
<h3 id="Scheduler（调度器）"><a href="#Scheduler（调度器）" class="headerlink" title="Scheduler（调度器）"></a><a href="https://rxjs.dev/guide/scheduler" target="_blank" rel="noopener">Scheduler（调度器）</a></h3><p><code>Scheduler</code> 控制着何时启动<code>subscription</code>和何时发送通知。它由三部分组成：</p>
<ul>
<li><strong>调度器是一种数据结构</strong>。它知道如何根据优先级或其他标准来存储任务和将任务进行排序。</li>
<li><strong>调度器是执行上下文</strong>。 它表示在何时何地执行任务(举例来说，立即的，或另一种回调函数机制(比如 setTimeout 或 process.nextTick)，或动画帧)。</li>
<li><strong>调度器有一个（虚拟的）时钟。</strong> 调度器功能通过它的 getter 方法 now() 提供了”时间”的概念。在具体调度器上安排的任务将严格遵循该时钟所表示的时间。</li>
</ul>
<blockquote>
<p>调度器可以让你规定 Observable 在什么样的执行上下文中发送通知给它的观察者。</p>
</blockquote>
<p>在之前的例子中我们是用<code>Obervable</code>同步的输出值。下面通过<code>observeOn</code>指的<code>async</code> 调度器去传递这些值。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Observable, asyncScheduler &#125; <span class="keyword">from</span> <span class="string">'rxjs'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; observeOn &#125; <span class="keyword">from</span> <span class="string">'rxjs/operators'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> observable = <span class="keyword">new</span> Observable(<span class="function">(<span class="params">observer</span>) =&gt;</span> &#123;</span><br><span class="line">  observer.next(<span class="number">1</span>);</span><br><span class="line">  observer.next(<span class="number">2</span>);</span><br><span class="line">  observer.next(<span class="number">3</span>);</span><br><span class="line">  observer.complete();</span><br><span class="line">&#125;).pipe(</span><br><span class="line">  observeOn(asyncScheduler) <span class="comment">//如果没有这个，则 just after subscribe 最后输出</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'just before subscribe'</span>);</span><br><span class="line">observable.subscribe(&#123;</span><br><span class="line">  next(x) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'got value '</span> + x);</span><br><span class="line">  &#125;,</span><br><span class="line">  error(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'something wrong occurred: '</span> + err);</span><br><span class="line">  &#125;,</span><br><span class="line">  complete() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'done'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'just after subscribe'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 输出</span></span><br><span class="line"><span class="comment">just before subscribe</span></span><br><span class="line"><span class="comment">just after subscribe</span></span><br><span class="line"><span class="comment">got value 1</span></span><br><span class="line"><span class="comment">got value 2</span></span><br><span class="line"><span class="comment">got value 3</span></span><br><span class="line"><span class="comment">done</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="Schedulers-调度器-类型"><a href="#Schedulers-调度器-类型" class="headerlink" title="Schedulers(调度器) 类型"></a>Schedulers(调度器) 类型</h4><p><code>async</code>调度器是 RxJS 提供的内部调度器之一。</p>
<table>
<thead>
<tr>
<th style="text-align:left">调度器</th>
<th style="text-align:left">目的</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>null</code></td>
<td style="text-align:left">不传递任何调度器的话，会以同步递归的方式发送通知。用于定时操作或尾递归操作。</td>
</tr>
<tr>
<td style="text-align:left"><code>queueScheduler</code></td>
<td style="text-align:left">当前事件帧中的队列调度(蹦床调度器)。用于迭代操作。</td>
</tr>
<tr>
<td style="text-align:left"><code>asapScheduler</code></td>
<td style="text-align:left">Schedules 是在微任务队列上, 它就像运行在 promises 队列上.在当前执行任务之后再下一个任务之前执行。它就像一个异步执行。</td>
</tr>
<tr>
<td style="text-align:left"><code>asyncScheduler</code></td>
<td style="text-align:left">Schedules 与 <code>setInterval</code> 一起使用.基础的调度器</td>
</tr>
<tr>
<td style="text-align:left"><code>animationFrameScheduler</code></td>
<td style="text-align:left">Schedules 会在浏览器下一次渲染之前执行. 它可以用来绘制流程的动画。</td>
</tr>
</tbody>
</table>
<h4 id="使用-Schedulers-调度器"><a href="#使用-Schedulers-调度器" class="headerlink" title="使用 Schedulers(调度器)"></a>使用 Schedulers(调度器)</h4><p>你可能在你的 RxJS 代码中已经使用过调度器了，只是没有明确地指明要使用的调度器的类型。这是因为所有的 Observable 操作符处理并发性都有可选的调度器。如果没有提供调度器的话，RxJS 会通过使用最小并发原则选择一个默认调度器。这意味着引入满足操作符需要的最小并发量的调度器会被选择。例如，对于返回有限和少量消息的 observable 的操作符，RxJS 不使用调度器，即 <code>null</code> 或 <code>undefined</code> 。对于返回潜在大量的或无限数量的消息的操作符，使用 <code>queueScheduler</code> 调度器。对于使用定时器的操作符，使用 <code>asyncScheduler</code> 调度器。</p>
<p><strong>静态创建操作符通常可以接收调度器作为参数。</strong> 举例来说，<code>from(array, scheduler)</code> 可以让你指定调度器，当发送从 <code>array</code> 转换的每个通知的时候使用。调度器通常作为操作符的最后一个参数。静态创建操作符接收调度器参数：</p>
<ul>
<li><code>bindCallback</code></li>
<li><code>bindNodeCallback</code></li>
<li><code>combineLatest</code></li>
<li><code>concat</code></li>
<li><code>empty</code></li>
<li><code>from</code></li>
<li><code>fromPromise</code></li>
<li><code>interval</code></li>
<li><code>merge</code></li>
<li><code>of</code></li>
<li><code>range</code></li>
<li><code>throw</code></li>
<li><code>timer</code></li>
</ul>
<p><strong>使用 <code>subscribeOn</code> 来调度 <code>subscribe()</code> 调用在什么样的上下文中执行。</strong> 默认情况下，Observable 的 <code>subscribe()</code> 调用会立即同步地执行。然而，你可能会延迟或安排在给定的调度器上执行实际的 subscription ，使用实例操作符 <code>subscribeOn(scheduler)</code>，其中 <code>scheduler</code> 是你提供的参数。</p>
<p><strong>使用 <code>observeOn</code> 来调度发送通知的的上下文。</strong> 正如我们在上面的示例中所看到的，实例操作符 <code>observeOn(scheduler)</code> 在源 Observable 和目标观察者之间引入了一个中介观察者，中介负责调度，它使用给定的 <code>scheduler</code> 来调用目标观察者。</p>
<p><code>bufferTime</code>、<code>debounceTime</code>、<code>delay</code>、<code>auditTime</code>、<code>sampleTime</code>、<code>throttleTime</code>、<code>timeInterval</code>、<code>timeout</code>、<code>timeoutWith</code>、<code>windowTime</code> 这样时间相关的操作符全部接收调度器作为最后的参数，并且默认的操作是在 <code>asyncScheduler</code> 调度器上。</p>
<p>其他接收调度器作为参数的实例操作符：<code>cache</code>、<code>combineLatest</code>、<code>concat</code>、<code>expand</code>、<code>merge</code>、<code>publishReplay</code>、<code>startWith</code>。</p>
<p>注意，<code>cache</code> 和 <code>publishReplay</code> 都接收调度器是因为它们使用了 ReplaySubject 。ReplaySubjects 的构造函数接收一个可选的调度器作为最后的参数，因为 ReplaySubject 可能会处理时间，这只在调度器的上下文中才有意义。默认情况下，ReplaySubject 使用 <code>queue</code> 调度器来提供时钟。</p>
<h2 id="RxJS-业务上的实践"><a href="#RxJS-业务上的实践" class="headerlink" title="RxJS 业务上的实践"></a>RxJS 业务上的实践</h2><h3 id="页面元素拖拽"><a href="#页面元素拖拽" class="headerlink" title="页面元素拖拽"></a>页面元素拖拽</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>RxJS 元素拖拽<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      html,</span></span><br><span class="line"><span class="undefined">      body &#123;</span></span><br><span class="line"><span class="undefined">        height: 100%;</span></span><br><span class="line"><span class="undefined">        background-color: tomato;</span></span><br><span class="line"><span class="undefined">        position: relative;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">      #drag &#123;</span></span><br><span class="line"><span class="undefined">        position: absolute;</span></span><br><span class="line"><span class="undefined">        display: inline-block;</span></span><br><span class="line"><span class="undefined">        width: 100px;</span></span><br><span class="line"><span class="undefined">        height: 100px;</span></span><br><span class="line"><span class="undefined">        background-color: #fff;</span></span><br><span class="line"><span class="undefined">        cursor: all-scroll;</span></span><br><span class="line"><span class="undefined">      &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"drag"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdn.bootcdn.net/ajax/libs/rxjs/6.6.3/rxjs.umd.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">      const &#123; fromEvent, operators &#125; = window.rxjs;</span></span><br><span class="line"><span class="undefined">      const &#123; flatMap, map, takeUntil &#125; = operators;</span></span><br><span class="line"><span class="undefined">      let dragDOM = document.getElementById('drag');</span></span><br><span class="line"><span class="undefined">      let body = document.body;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">      const mouseDown = fromEvent(dragDOM, 'mousedown');</span></span><br><span class="line"><span class="undefined">      const mouseUp = fromEvent(body, 'mouseup');</span></span><br><span class="line"><span class="undefined">      const mouseMove = fromEvent(body, 'mousemove');</span></span><br><span class="line"><span class="undefined">      mouseDown</span></span><br><span class="line"><span class="undefined">        .pipe(</span></span><br><span class="line"><span class="undefined">          flatMap((event) =&gt; mouseMove.pipe(takeUntil(mouseUp))),</span></span><br><span class="line"><span class="undefined">          map((event) =&gt; (&#123; x: event.clientX, y: event.clientY &#125;))</span></span><br><span class="line"><span class="undefined">        )</span></span><br><span class="line"><span class="undefined">        .subscribe((pos) =&gt; &#123;</span></span><br><span class="line"><span class="undefined">          dragDOM.style.left = `$&#123;pos.x&#125;px`;</span></span><br><span class="line"><span class="undefined">          dragDOM.style.top = `$&#123;pos.y&#125;px`;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Refer-To"><a href="#Refer-To" class="headerlink" title="Refer To"></a>Refer To</h2><p><a href="https://rxjs.dev/guide/overview" target="_blank" rel="noopener">https://rxjs.dev/guide/overview</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/274469124" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/274469124</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/270609123" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/270609123</a></p>
<p><a href="https://cisy.me/rxjs/" target="_blank" rel="noopener">https://cisy.me/rxjs/</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/34357403" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34357403</a></p>
<p><a href="https://www.cnblogs.com/star91/p/rxjs-ru-men.html" target="_blank" rel="noopener">https://www.cnblogs.com/star91/p/rxjs-ru-men.html</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/146795979" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/146795979</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/34357403" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34357403</a></p>

      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="https://fynn90.github.io">Fynn</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="https://fynn90.github.io/2021/03/03/RxJS/">https://fynn90.github.io/2021/03/03/RxJS/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>



      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden />
    <label class="reward-button" for="reward">赞赏支持</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/wechat.png" title="wechat">
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/alipay.png" title="alipay">
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/RxJS/">RxJS</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
    
      <a class="next" href="/2021/02/18/InversifyJS/">
        <span class="next-text nav-default">InversifyJS</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:fynn.90@outlook.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
        
          <a href="https://www.linkedin.com/in/%E5%B8%86-%E9%82%93-17163589/" class="iconfont icon-linkedin" title="linkedin"></a>
        
      
    
      
        
          <a href="https://plus.google.com/u/0/117459332873536225443" class="iconfont icon-google" title="google"></a>
        
      
    
      
        
          <a href="https://github.com/fynn90" class="iconfont icon-github" title="github"></a>
        
      
    
      
        
          <a href="http://www.weibo.com/306019091" class="iconfont icon-weibo" title="weibo"></a>
        
      
    
      
        
          <a href="https://www.zhihu.com/people/FynnDeng/activities" class="iconfont icon-zhihu" title="zhihu"></a>
        
      
    
      
    
      
    
      
    
    
    
  </div>


<div class="copyright">
  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2021

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Fynn</span>
  </span>
  
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>
