<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Flask介绍"/>




  <meta name="keywords" content="Flask, Fynn's Blog" />










  <link rel="alternate" href="/atom.xml" title="Fynn's Blog">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0" />



<link rel="canonical" href="https://fynn90.github.io/2017/12/09/Flask介绍/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0" />



  <link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css" />




  
  <script id="baidu_analytics">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?607980a031d3edcefed502ce80e77ffb";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <script id="google_analytics">
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-115728733-1', 'auto');
        ga('send', 'pageview');
  </script>


  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>





  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "jH321kB4p1r5FNrL8YBCwbrG-gzGzoHsz",
      appKey: "Q8vnaBtTzmVPbVX8tdzM7z7w"
    });
  </script>





    <title> Flask介绍 - Fynn's Blog </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Fynn's Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            首页
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            归档
          
        </li>
      </a>
    
      <a href="/categories/">
        <li class="mobile-menu-item">
          
          
            分类
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Fynn's Blog</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              首页
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              归档
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            
            
              分类
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Flask介绍
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-12-09
        </span>
        
          <div class="post-category">
            
              <a href="/categories/python/">python</a>
            
              <a href="/categories/python/Flask/">Flask</a>
            
          </div>
        
        
        <div class="post-visits"
             data-url="/2017/12/09/Flask介绍/"
             data-title="Flask介绍">
            阅读次数
          </div>
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hello-World"><span class="toc-text">Hello World</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Debug-Mode"><span class="toc-text">Debug Mode</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Command-Line"><span class="toc-text">Command Line</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#In-Code"><span class="toc-text">In Code</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#路由"><span class="toc-text">路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#变量规则"><span class="toc-text">变量规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP请求类型"><span class="toc-text">HTTP请求类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构造URL"><span class="toc-text">构造URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#唯一URL-重定向行为"><span class="toc-text">唯一URL/重定向行为</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求"><span class="toc-text">请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#响应"><span class="toc-text">响应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#返回视图"><span class="toc-text">返回视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#返回JSON"><span class="toc-text">返回JSON</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#添加headers信息-flask-make-response"><span class="toc-text">添加headers信息 flask.make_response</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过Response返回JSON数据"><span class="toc-text">通过Response返回JSON数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#蓝图（Blueprint）"><span class="toc-text">蓝图（Blueprint）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建一个Blueprint"><span class="toc-text">创建一个Blueprint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注册Blueprint"><span class="toc-text">注册Blueprint</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#即插视图（Pluggable-Views）"><span class="toc-text">即插视图（Pluggable Views）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#方法提示"><span class="toc-text">方法提示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flask-views-MethodView"><span class="toc-text">flask.views.MethodView</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置处理"><span class="toc-text">配置处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#app-config-from-object"><span class="toc-text">app.config.from_object()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app-config-from-pyfile"><span class="toc-text">app.config.from_pyfile()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app-config-from-envvar"><span class="toc-text">app.config.from_envvar()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#插件"><span class="toc-text">插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-Migrate"><span class="toc-text">Flask-Migrate</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#例子"><span class="toc-text">例子</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-Login"><span class="toc-text">Flask-Login</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-1"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#基础用法"><span class="toc-text">基础用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#保护视图-flask-ext-login-login-required-func-source"><span class="toc-text">保护视图  flask.ext.login.login_required(func)[source]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定制登录-Request-Loader"><span class="toc-text">定制登录 Request Loader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#记住我"><span class="toc-text">记住我</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#新鲜登录"><span class="toc-text">新鲜登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#会话保护"><span class="toc-text">会话保护</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask-Session"><span class="toc-text">Flask-Session</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装-2"><span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#保存到redis"><span class="toc-text">保存到redis</span></a></li></ol></li></ol></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p><a href="http://flask.pocoo.org/" target="_blank" rel="noopener">Flask</a>是Python微框架，基于<a href="http://werkzeug.pocoo.org/docs/0.12/" target="_blank" rel="noopener">Werkzeuy</a>和<a href="http://jinja.pocoo.org/docs/2.10/" target="_blank" rel="noopener">Jinja2</a>实现。</p>
<p><img src="http://docs.jinkan.org/docs/flask/_images/logo-full.png" alt=""></p>
<p>Flask不包含数据库层，也不会包含表单库或是这个方向的其他东西。Flask建立在Werkezug和Jinja2的桥梁，前者实现一个合适的WSGI应用，后者处理模板。Flask也绑定了一些通用的标准库包，比如logging。其他所有一切取决于扩展。<br><a id="more"></a><br>Flask的思想是为所有应用建立一个良好的基础，其余的一切都取决于你和扩展。</p>
<h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a><a href="http://flask.pocoo.org/docs/0.12/quickstart/" target="_blank" rel="noopener">Hello World</a></h2><p>创建一个<code>hello.py</code>文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World!"</span></span><br></pre></td></tr></table></figure>
<p>安装<code>Flask</code>并执行<code>hello.py</code>文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">$</span><span class="bash"> pip install Flask</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> FLASK_APP=hello.py</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> flask run</span></span><br><span class="line"> * Running on http://localhost:5000/</span><br></pre></td></tr></table></figure>
<p>If you are on Windows you need to use <code>set</code> instead of <code>export</code>.<br><code>Flask</code>最新版本<a href="https://pypi.python.org/pypi/Flask/0.12.2" target="_blank" rel="noopener">0.12.2</a>。建议在Python3.x环境下运行。<br><strong>注意：</strong> 上面的服务只能在你本地电脑才能访问，因为默认的debugging 模式下，应用的代码可以在你的电脑上运行。<br>如果你想让其他人电脑也可以访问你的这个服务，你只需要执行<code>flask run --host=0.0.0.0</code>。<br>上面操作告诉系统允许所有公网IP访问。</p>
<h2 id="Debug-Mode"><a href="#Debug-Mode" class="headerlink" title="Debug Mode"></a>Debug Mode</h2><p>当开发时每当改变你的代码，<code>Flask</code>就需要重启一次。<code>Flask</code>提供了<code>debug</code>模式支持当代码变动时自动重启应用。</p>
<p>开启<code>debug</code>模式，你需要在允许服务器前定义<code>FLASK_DEBUG</code>环境变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ export FLASK_APP=hello.py</span><br><span class="line">$ export FLASK_DEBUG=1</span><br><span class="line">$ flask run</span><br></pre></td></tr></table></figure>
<p>(在windows环境下<code>export</code>需替换成<code>set</code>)<br>上面代码完成了三个操作：</p>
<ul>
<li>激活了debugger</li>
<li>激活了自动加载</li>
<li>开启了debug模式</li>
</ul>
<p>从<code>Flask</code>0.11开始你有多种构建方法运行开发服务。推荐使用<code>flask</code>命令行模式，也可以继续使用<code>Flask.run()</code>方法。</p>
<h3 id="Command-Line"><a href="#Command-Line" class="headerlink" title="Command Line"></a>Command Line</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> FLASK_APP=my_application</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">export</span> FLASK_DEBUG=1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> flask run</span></span><br></pre></td></tr></table></figure>
<p>这推荐使用的运行开发服务模式。你也可以通过传递参数给<code>run</code>操作符。例如禁止重新加载：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">$</span><span class="bash"> flask run --no-reload</span></span><br></pre></td></tr></table></figure><br>如果不指定设置<code>FLASK_APP</code>环境变量，可以通过<code>flask run --reload</code>实现文件变动自动刷新</p>
<h3 id="In-Code"><a href="#In-Code" class="headerlink" title="In Code"></a>In Code</h3><p>可以通过<code>Flask.run()</code>方法启动服务。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	app.run()</span><br></pre></td></tr></table></figure>
<p>上面如果在Debug模式下会导致一些奇怪的事情发生（一段代码执行两次，意外崩溃，死机当语法或导入错误）。所以在<code>flask</code>0.11后推荐使用命令行模式启动服务。</p>
<p><strong>注意：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">尽管交互式调试器在允许 fork 的环境中无法正常使用（也即在生产服务器上正常使用几乎是不可能的），但它依然允许执行任意代码。这使它成为一个巨大的安全隐患，因此它 绝对不能用于生产环境 。</span><br></pre></td></tr></table></figure></p>
<h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><p><code>Flask</code>路由系统继承于<code>Werkzeug</code>路由系统进行了封住。</p>
<p>路由例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Index Page'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/hello')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello, World'</span></span><br></pre></td></tr></table></figure>
<p><a href="http://flask.pocoo.org/docs/0.12/api/#flask.Flask.route" target="_blank" rel="noopener"><code>@app.route(rule, **options)</code></a>装饰器，将url规则于视图函数进行绑定。当url规则匹配到将触发对应的方法。</p>
<p>也可以通过<a href="http://flask.pocoo.org/docs/0.12/api/#flask.Flask.add_url_rule" target="_blank" rel="noopener"><code>app.add_url_rule(rule, endpoint=None, view_func=None, **options)</code></a>方法手动将路由规则和视图函数进行绑定。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cat</span> <span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">'Cat Page'</span></span><br><span class="line">app.add_url_rule(<span class="string">'/cat'</span>,<span class="string">'cat'</span>,cat)</span><br><span class="line"><span class="comment"># app.add_url_rule('/cat',view_func=cat)</span></span><br></pre></td></tr></table></figure>
<h3 id="变量规则"><a href="#变量规则" class="headerlink" title="变量规则"></a>变量规则</h3><p>URL上可以添加变量部分，你只需要标记为<code>&lt;variable_name&gt;</code>。<br>变量部分将通过定义的变量关键字通过参数传递给视图函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/user/&lt;username&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_name</span><span class="params">(username)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">'Hello %s'</span>% username</span><br></pre></td></tr></table></figure>
<p>一个视图函数可以绑定多个路由装饰器，如果路由装饰器有变量部分，可以在视图函数指定默认变量值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/user/')</span></span><br><span class="line"><span class="meta">@app.route('/user/&lt;username&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_name</span><span class="params">(username=<span class="string">'world'</span>)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">'Hello %s'</span>% username</span><br></pre></td></tr></table></figure>
<p>可以将变量部分转换为指定的类型，只需将变量部分定义成<code>&lt;converter:name&gt;</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/post/&lt;int:post_id&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_post</span><span class="params">(post_id)</span>:</span></span><br><span class="line">    <span class="comment"># show the post with the given id, the id is an integer</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Post %d'</span> % post_id</span><br></pre></td></tr></table></figure>
<p>支持的转换类型有这些：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>string</td>
<td>接收任何类型 除了斜杠</td>
</tr>
<tr>
<td>int</td>
<td>接收整数</td>
</tr>
<tr>
<td>float</td>
<td>接收浮点数</td>
</tr>
<tr>
<td>path</td>
<td>像默认，但也接受斜杠</td>
</tr>
<tr>
<td>any</td>
<td>匹配提供的项目之一</td>
</tr>
<tr>
<td>uuid</td>
<td>接收 uuid字符串</td>
</tr>
</tbody>
</table>
<h3 id="HTTP请求类型"><a href="#HTTP请求类型" class="headerlink" title="HTTP请求类型"></a>HTTP请求类型</h3><p>可以指定视图函数触发的请求类型，这样可以根据不同请求类型进行不同处理或者触发不同视图函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/login', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        do_the_login()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        show_the_login_form()</span><br></pre></td></tr></table></figure>
<p>支持的请求类型有：</p>
<ul>
<li>GET - 浏览器告诉服务器想获取一些信息。 </li>
<li>HEAD - 浏览器告诉服务器：欲获取信息，但是只关心 消息头 。应用应像处理 GET 请求一样来处理它，但是不分发实际内容。在 Flask 中你完全无需 人工 干预，底层的 Werkzeug 库已经替你打点好了。</li>
<li>POST - 浏览器告诉服务器：想在 URL 上 发布 新信息。并且，服务器必须确保 数据已存储且仅存储一次。这是 HTML 表单通常发送数据到服务器的方法。</li>
<li>PUT - 类似 POST 但是服务器可能触发了存储过程多次，多次覆盖掉旧值。你可 能会问这有什么用，当然这是有原因的。考虑到传输中连接可能会丢失，在 这种 情况下浏览器和服务器之间的系统可能安全地第二次接收请求，而 不破坏其它东西。因为 POST 它只触发一次，所以用 POST 是不可能的。</li>
<li>DELETE - 删除给定位置的信息。</li>
<li>OPTIONS - 给客户端提供一个敏捷的途径来弄清这个 URL 支持哪些 HTTP 方法。 从 Flask 0.6 开始，实现了自动处理。</li>
</ul>
<h3 id="构造URL"><a href="#构造URL" class="headerlink" title="构造URL"></a>构造URL</h3><p>如果 Flask 能匹配 URL，那么 Flask 可以生成它们吗？当然可以。你可以用 url_for() 来给指定的函数构造 URL。它接受函数名作为第一个参数，也接受对应 URL 规则的变量部分的命名参数。未知变量部分会添加到 URL 末尾作为查询参数。例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, url_for</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>app = Flask(__name__)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@app.route(<span class="string">'/'</span>)</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span> <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@app.route(<span class="string">'/login'</span>)</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">()</span>:</span> <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>@app.route(<span class="string">'/user/&lt;username&gt;'</span>)</span><br><span class="line"><span class="meta">... </span><span class="function"><span class="keyword">def</span> <span class="title">profile</span><span class="params">(username)</span>:</span> <span class="keyword">pass</span></span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> app.test_request_context():</span><br><span class="line"><span class="meta">... </span> <span class="keyword">print</span> url_for(<span class="string">'index'</span>)</span><br><span class="line"><span class="meta">... </span> <span class="keyword">print</span> url_for(<span class="string">'login'</span>)</span><br><span class="line"><span class="meta">... </span> <span class="keyword">print</span> url_for(<span class="string">'login'</span>, next=<span class="string">'/'</span>)</span><br><span class="line"><span class="meta">... </span> <span class="keyword">print</span> url_for(<span class="string">'profile'</span>, username=<span class="string">'John Doe'</span>)</span><br><span class="line">...</span><br><span class="line">/</span><br><span class="line">/login</span><br><span class="line">/login?next=/</span><br><span class="line">/user/John%<span class="number">20</span>Doe</span><br></pre></td></tr></table></figure>
<h3 id="唯一URL-重定向行为"><a href="#唯一URL-重定向行为" class="headerlink" title="唯一URL/重定向行为"></a>唯一URL/重定向行为</h3><p>Flask 的 URL 规则基于 Werkzeug 的路由模块。这个模块背后的思想是基于 Apache 以及更早的 HTTP 服务器主张的先例，保证优雅且唯一的 URL。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/projects/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">projects</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'The project page'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/about')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">about</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'The about page'</span></span><br></pre></td></tr></table></figure>
<p>虽然它们看起来着实相似，但它们结尾斜线的使用在 URL 定义 中不同。 第一种情况中，指向 projects 的规范 URL 尾端有一个斜线。这种感觉很像在文件系统中的文件夹。访问一个结尾不带斜线的 URL 会被 Flask 重定向到带斜线的规范 URL 去。</p>
<p>然而，第二种情况的 URL 结尾不带斜线，类似 UNIX-like 系统下的文件的路径名。访问结尾带斜线的 URL 会产生一个 404 “Not Found” 错误。</p>
<p>这个行为使得在遗忘尾斜线时，允许关联的 URL 接任工作，与 Apache 和其它的服务器的行为并无二异。此外，也保证了 URL 的唯一，有助于避免搜索引擎索引同一个页面两次。</p>
<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a><a href="http://flask.pocoo.org/docs/0.12/api/#incoming-request-data" target="_blank" rel="noopener">请求</a></h2><p><code>Flask</code>中http请求会绑定在全局变量<code>request</code>上。<br>在一个视图函数通过<code>request</code>对象获取请求数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/login',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span> <span class="params">()</span>:</span></span><br><span class="line">	error = <span class="keyword">None</span></span><br><span class="line">	<span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">		username = request.form[<span class="string">'username'</span>]</span><br><span class="line">		password = request.form[<span class="string">'password'</span>]</span><br><span class="line">		<span class="keyword">return</span> <span class="string">'登录中'</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">'请登录~'</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>request.form[&#39;xxx&#39;]</code>获取表单提交的数据（POST或PUT请求）</li>
<li><code>request.method</code> 获取请求方法</li>
<li><code>request.path</code> 获取请求地址</li>
<li><code>request.args.get(&#39;key&#39;,&#39;&#39;)</code>获取URL上参数</li>
<li><code>request.cookies.get(&#39;username&#39;)</code>获取<code>username</code>cookie值</li>
</ul>
<h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a><a href="http://flask.pocoo.org/docs/0.12/quickstart/#about-responses" target="_blank" rel="noopener">响应</a></h2><p>从视图函数返回的值会自动转换成响应对象。如果返回值是一个字符串，它会转换成响应对象并且字符串作为响应主体。</p>
<p>Flask转换返回值为响应对象的逻辑如下：</p>
<ul>
<li>如果返回是正确类型的响应对象，则直接从视图函数返回。</li>
<li>如果是个字符串，使用这个数据和默认参数创建响应对象。</li>
<li>如果是个元组，这个元组提供额外的信息。这个元组形式必须是<code>(response,status,headers)</code>或<code>(response,headers)</code>最少有一项是在元组中。<code>status</code>会覆盖状态码。<code>headers</code>能够是个列表或一个字典补充头部信息。</li>
<li>如果上面条件都没满足，<code>Flask</code>会假定返回一个合肥的<code>WSGI</code>应用值，然后将它转换响应对象。</li>
</ul>
<h3 id="返回视图"><a href="#返回视图" class="headerlink" title="返回视图"></a><a href="http://flask.pocoo.org/docs/0.12/quickstart/#rendering-templates" target="_blank" rel="noopener">返回视图</a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/hello/')</span></span><br><span class="line"><span class="meta">@app.route('/hello/&lt;name&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name=None)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'hello.html'</span>, name=name)</span><br></pre></td></tr></table></figure>
<p><code>render_template(template,data)</code>渲染模板函数。</p>
<p><code>Flask</code>会去<strong>templates</strong> 目录查找模板（<code>hello.html</code>）。如果你的应用是一个模块，这个模板文件夹应该和这个模块在一个层级上。：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/application.py</span><br><span class="line">/templates</span><br><span class="line">	/hello.html</span><br></pre></td></tr></table></figure><br>如果你的应用是个包，则这个模板文件夹应该在包里面：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/application</span><br><span class="line">    /__init__.py</span><br><span class="line">    /templates</span><br><span class="line">        /hello.html</span><br></pre></td></tr></table></figure>
<h3 id="返回JSON"><a href="#返回JSON" class="headerlink" title="返回JSON"></a><a href="https://www.polarxiong.com/archives/Flask%E8%AE%BE%E7%BD%AE%E8%BF%94%E5%9B%9Ejson%E6%A0%BC%E5%BC%8F.html" target="_blank" rel="noopener">返回JSON</a></h3><p>如果在视图函数直接返回一个<code>dict</code>对象，<code>Flask</code>会报错（<code>TypeError: &#39;dict&#39; object is not callable</code>）。<br>可以通过<a href="http://flask.pocoo.org/docs/0.12/api/#flask.json.jsonify" target="_blank" rel="noopener"><code>jsonify</code></a>方法对<code>dict</code>对象进行包装再返回。  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">root</span><span class="params">()</span>:</span></span><br><span class="line">    t = &#123;</span><br><span class="line">        <span class="string">'a'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">'b'</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="string">'c'</span>: [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jsonify(t)</span><br></pre></td></tr></table></figure>
<h3 id="添加headers信息-flask-make-response"><a href="#添加headers信息-flask-make-response" class="headerlink" title="添加headers信息 flask.make_response"></a>添加headers信息 <a href="http://flask.pocoo.org/docs/0.12/api/#flask.make_response" target="_blank" rel="noopener">flask.make_response</a></h3><p>有时我们需要在视图头部添加一些信息。视图不需要返回一个响应对象，因为Flask会自动将它转换成响应对象。可以调用<code>flask.make_response()</code>方法而不是返回，你获取一个响应对象，这样你就可以添加头部信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    response = make_response(render_template(<span class="string">'index.html'</span>, foo=<span class="number">42</span>))</span><br><span class="line">    response.headers[<span class="string">'X-Parachutes'</span>] = <span class="string">'parachutes are cool'</span></span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h3 id="通过Response返回JSON数据"><a href="#通过Response返回JSON数据" class="headerlink" title="通过Response返回JSON数据"></a>通过Response返回JSON数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Response</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">root</span> <span class="params">()</span>:</span></span><br><span class="line">    t = &#123;<span class="string">'success'</span>: <span class="keyword">True</span>, <span class="string">'msg'</span>: <span class="string">'ok!'</span>&#125;</span><br><span class="line">    res = Response(json.dumps(t), mimetype=<span class="string">'application/json'</span>)</span><br><span class="line">    res.set_cookie(key=<span class="string">"logined"</span>, value=<span class="string">'true'</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<h2 id="蓝图（Blueprint）"><a href="#蓝图（Blueprint）" class="headerlink" title="蓝图（Blueprint）"></a><a href="http://flask.pocoo.org/docs/0.12/blueprints/" target="_blank" rel="noopener">蓝图（Blueprint）</a></h2><p>Flask用于实现模块化组织程序结构的方法。</p>
<p>在开发一个web项目时，通常使用两种方式组织架构：</p>
<ul>
<li>功能式架构 - 在功能式架构中，按照每部分代码的功能来组织你的应用。所有模板放到同一个文件夹中，静态文件放在另一个文件夹中，而视图放在第三个文件夹中。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">yourapp/</span><br><span class="line">    __init__.py</span><br><span class="line">    static/</span><br><span class="line">    templates/</span><br><span class="line">        home/</span><br><span class="line">        control_panel/</span><br><span class="line">        admin/</span><br><span class="line">    views/</span><br><span class="line">        __init__.py</span><br><span class="line">        home.py</span><br><span class="line">        control_panel.py</span><br><span class="line">        admin.py</span><br><span class="line">    models.py</span><br></pre></td></tr></table></figure>
<ul>
<li>分区式架构 - 在分区式架构中，按照每一部分所属的蓝图来组织你的应用。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">yourapp/</span><br><span class="line">    __init__.py</span><br><span class="line">    admin/</span><br><span class="line">        __init__.py</span><br><span class="line">        views.py</span><br><span class="line">        static/</span><br><span class="line">        templates/</span><br><span class="line">    home/</span><br><span class="line">        __init__.py</span><br><span class="line">        views.py</span><br><span class="line">        static/</span><br><span class="line">        templates/</span><br><span class="line">    control_panel/</span><br><span class="line">        __init__.py</span><br><span class="line">        views.py</span><br><span class="line">        static/</span><br><span class="line">        templates/</span><br><span class="line">    models.py</span><br></pre></td></tr></table></figure>
<p>将相关联的部分作为一个<code>blueprint</code>，这样遍历管理和多人协同开发。最后只需要将<code>blueprints</code>汇集起来注册到<code>Flask</code>。</p>
<h3 id="创建一个Blueprint"><a href="#创建一个Blueprint" class="headerlink" title="创建一个Blueprint"></a>创建一个Blueprint</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line">admin = Blueprint(<span class="string">'admin'</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@admin.route('/login/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_login</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@admin.route('/login_out/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_login_out</span><span class="params">()</span>:</span></span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="http://flask.pocoo.org/docs/0.12/api/#flask.Blueprint" target="_blank" rel="noopener"><code>Blueprint(name, import_name)</code></a>类接受参数<code>name</code>和<code>import_name</code>进行初始化。通常用<code>__name__</code>表示当前模块的特殊Python变量，作为<code>import_name</code>的取值。</p>
<p>如果你使用分区式架构，你得告诉<code>Flask</code>某个蓝图有自己得模板和静态文件夹你需要另外传两个参数<code>template_folder</code>和<code>static_folder</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin = Blueprint(<span class="string">'admin'</span>, __name__,</span><br><span class="line">                    template_folder=<span class="string">'templates'</span>,</span><br><span class="line">                    static_folder=<span class="string">'static'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="注册Blueprint"><a href="#注册Blueprint" class="headerlink" title="注册Blueprint"></a>注册Blueprint</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> application.admin <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.register_blueprint(admin,url_prefix=<span class="string">'/admin'</span>)</span><br></pre></td></tr></table></figure>
<p><a href="http://flask.pocoo.org/docs/0.12/api/#flask.Flask.register_blueprint" target="_blank" rel="noopener"><code>register_blueprint(blueprint,url_prefix)</code></a>将blueprint注册到Flask应用中，并给blueprint定义一个公用得url前缀。</p>
<h2 id="即插视图（Pluggable-Views）"><a href="#即插视图（Pluggable-Views）" class="headerlink" title="即插视图（Pluggable Views）"></a><a href="http://flask.pocoo.org/docs/0.12/views/" target="_blank" rel="noopener">即插视图（Pluggable Views）</a></h2><p>将视图函数转为成为类，以便于扩展和通用。例如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/users/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_users</span><span class="params">(page)</span>:</span></span><br><span class="line">    users = User.query.all()</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'users.html'</span>, users=users)</span><br></pre></td></tr></table></figure><br>上面视图函数简单而灵活，但如果需要同样适应其他模型或模板得方式，你需要更大得灵活性。你需要基于类得即插视图。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShowUsers</span><span class="params">(View)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch_request</span><span class="params">(self)</span>:</span></span><br><span class="line">        users = User.query.all()</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'users.html'</span>, objects=users)</span><br><span class="line"></span><br><span class="line">app.add_url_rule(<span class="string">'/users/'</span>, ShowUsers.as_view(<span class="string">'show_users'</span>))</span><br></pre></td></tr></table></figure>
<p>你需要创建一个<a href="http://flask.pocoo.org/docs/0.12/api/#flask.views.View" target="_blank" rel="noopener"><code>flask.views.View</code></a>的子类，并且实现<a href="http://flask.pocoo.org/docs/0.12/api/#flask.views.View.dispatch_request" target="_blank" rel="noopener"><code>dispatch_request()</code></a>。然后需要通过<a href="http://flask.pocoo.org/docs/0.12/api/#flask.views.View.as_view" target="_blank" rel="noopener"><code>as_view()</code></a>类方法将类转换到一个实际的视图函数。你传的这个函数的字符串是视图之后的终极名称，在Flask内部将通过这个endpoint找到对应的view function。</p>
<h3 id="方法提示"><a href="#方法提示" class="headerlink" title="方法提示"></a>方法提示</h3><p>即插视图可以像常规函数用<code>route()</code>或<code>add_url_rule()</code>附加到应用上。你可以在类定义<code>methods=[]</code>指定视图函数接收的请求类型。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyView</span><span class="params">(View)</span>:</span></span><br><span class="line">    methods = [<span class="string">'GET'</span>, <span class="string">'POST'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dispatch_request</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">            ...</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">app.add_url_rule(<span class="string">'/myview'</span>, view_func=MyView.as_view(<span class="string">'myview'</span>))</span><br></pre></td></tr></table></figure>
<h3 id="flask-views-MethodView"><a href="#flask-views-MethodView" class="headerlink" title="flask.views.MethodView"></a>flask.views.MethodView</h3><p>通过<a href="http://flask.pocoo.org/docs/0.12/api/#flask.views.MethodView" target="_blank" rel="noopener"><code>MethodView</code></a>类可以方便的在处理相同路径下不同请求方式情况。每个 HTTP 方法映射到同名函数 （只有名称为小写的）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask.views <span class="keyword">import</span> MethodView</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAPI</span><span class="params">(MethodView)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, user_id)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> user_id <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="comment"># return a list of users</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># expose a single user</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># create a new user</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, user_id)</span>:</span></span><br><span class="line">        <span class="comment"># delete a single user</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, user_id)</span>:</span></span><br><span class="line">        <span class="comment"># update a single user</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">user_view = UserAPI.as_view(<span class="string">'user_api'</span>)</span><br><span class="line">app.add_url_rule(<span class="string">'/users/'</span>, defaults=&#123;<span class="string">'user_id'</span>: <span class="keyword">None</span>&#125;,</span><br><span class="line">                 view_func=user_view, methods=[<span class="string">'GET'</span>,])</span><br><span class="line">app.add_url_rule(<span class="string">'/users/'</span>, view_func=user_view, methods=[<span class="string">'POST'</span>,])</span><br><span class="line">app.add_url_rule(<span class="string">'/users/&lt;int:user_id&gt;'</span>, view_func=user_view,</span><br><span class="line">                 methods=[<span class="string">'GET'</span>, <span class="string">'PUT'</span>, <span class="string">'DELETE'</span>])</span><br></pre></td></tr></table></figure>
<h2 id="配置处理"><a href="#配置处理" class="headerlink" title="配置处理"></a><a href="http://flask.pocoo.org/docs/0.12/config/" target="_blank" rel="noopener">配置处理</a></h2><p>在实际开发中一般会面对不同的环境，每个环境都会自己的配置项。<br><code>Flask</code>提供了<code>app.config.from_object()</code>,<code>app.config.from_pyfile()</code>,<code>app.config.from_envvar()</code>方法用于不同环境加载不同配置项。</p>
<h3 id="app-config-from-object"><a href="#app-config-from-object" class="headerlink" title="app.config.from_object()"></a><a href="http://flask.pocoo.org/docs/0.12/api/#flask.Config.from_object" target="_blank" rel="noopener">app.config.from_object()</a></h3><p><code>app.config.from_object(object)</code>接收一个python对象。实际开发中推荐为不同环境创建不同的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|config</span><br><span class="line">    |__init__.py</span><br><span class="line">    | default.py</span><br><span class="line">    | development.py</span><br><span class="line">    | producation.py</span><br><span class="line">    | test.py</span><br></pre></td></tr></table></figure>
<p>在启动文件可以这样调用<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config.from_object(<span class="string">'config.default'</span>)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><figcaption><span>config.default</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DEBUG=<span class="keyword">True</span></span><br></pre></td></tr></table></figure>
<h3 id="app-config-from-pyfile"><a href="#app-config-from-pyfile" class="headerlink" title="app.config.from_pyfile()"></a><a href="http://flask.pocoo.org/docs/0.12/api/#flask.Config.from_pyfile" target="_blank" rel="noopener">app.config.from_pyfile()</a></h3><p>有时你需要定义一些不能为人所知的配置变量。为此，你会想要把它们从config.py中的其他变量分离出来，并保持在版本控制之外。 你可能要隐藏类似数据库密码和API密钥的秘密，或定义特定于当前机器的参数。 为了让这更加轻松，Flask提供了一个叫instance文件夹的特性。 instance文件夹是根目录的一个子文件夹，包括了一个特定于当前应用实例的配置文件。我们不要把它提交到版本控制中。</p>
<p>这是一个使用了instance文件夹的简单Flask应用的结构:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">config.py</span><br><span class="line">requirements.txt</span><br><span class="line">run.py</span><br><span class="line">instance/</span><br><span class="line">  config.py</span><br><span class="line">yourapp/</span><br><span class="line">  __init__.py</span><br><span class="line">  models.py</span><br><span class="line">  views.py</span><br><span class="line">  templates/</span><br><span class="line">  static/</span><br></pre></td></tr></table></figure>
<p>要想加载定义在instance文件夹中的配置变量，你可以使用<code>app.config.from_pyfile()</code>。 如果在调用Flask()创建应用时设置了<code>instance_relative_config=True</code>，<code>app.config.from_pyfile()</code>将查看在instance文件夹的特殊文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__, instance_relative_config=<span class="keyword">True</span>)</span><br><span class="line">app.config.from_object(<span class="string">'config'</span>)</span><br><span class="line">app.config.from_pyfile(<span class="string">'config.py'</span>)</span><br></pre></td></tr></table></figure>
<p>现在，你可以在<code>instance/config.py</code>中定义变量，一如在config.py。 你也应该将instance文件夹加入到版本控制系统的忽略名单中。比如假设你用的是git，你需要在gitignore中新开一行，写下instance/。</p>
<h3 id="app-config-from-envvar"><a href="#app-config-from-envvar" class="headerlink" title="app.config.from_envvar()"></a><a href="http://flask.pocoo.org/docs/0.12/api/#flask.Config.from_envvar" target="_blank" rel="noopener">app.config.from_envvar()</a></h3><p>你可以在命令行模式设定环境变量，这个环境变量应该是配置文件的<strong>绝对路径</strong> 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__, instance_relative_config=<span class="keyword">True</span>)</span><br><span class="line">app.config.from_object(<span class="string">'config.default'</span>)</span><br><span class="line">app.config.from_pyfile(<span class="string">'config.py'</span>) <span class="comment"># 从instance文件夹中加载配置</span></span><br><span class="line">app.config.from_envvar(<span class="string">'APP_CONFIG_FILE'</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> APP_CONFIG_FILE=/var/www/yourapp/config/production.py</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python run.py</span></span><br></pre></td></tr></table></figure>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><h3 id="Flask-Migrate"><a href="#Flask-Migrate" class="headerlink" title="Flask-Migrate"></a><a href="https://flask-migrate.readthedocs.io/en/latest/" target="_blank" rel="noopener">Flask-Migrate</a></h3><p>Flask-Migrate用于对SQLAlchemy数据迁移进行操作的Flask插件。</p>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Flask-Migrate</span><br></pre></td></tr></table></figure>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"><span class="keyword">from</span> flask_migrate <span class="keyword">import</span> Migrate</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SQLALCHEMY_DATABASE_URI'</span>] = <span class="string">'sqlite:///app.db'</span></span><br><span class="line"></span><br><span class="line">db = SQLAlchemy(app)</span><br><span class="line">migrate = Migrate(app, db) <span class="comment"># 将应用和数据关联起来</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(db.Model)</span>:</span></span><br><span class="line">    id = db.Column(db.Integer, primary_key=<span class="keyword">True</span>)</span><br><span class="line">    name = db.Column(db.String(<span class="number">128</span>))</span><br></pre></td></tr></table></figure>
<p>对上面的应用，可以使用下面命令创建迁移仓库：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> flask db init</span></span><br></pre></td></tr></table></figure><br>执行完后在应用目录下会多个<strong>migrations</strong> 文件夹。文件夹里面的内容需要和其它源文件一起添加进你的版本控制。</p>
<p>你可以生成初始迁移：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> flask db migrate</span></span><br></pre></td></tr></table></figure></p>
<p>Flask-Migrate是基于<a href="http://alembic.zzzcomputing.com/en/latest/autogenerate.html#what-does-autogenerate-detect-and-what-does-it-not-detect" target="_blank" rel="noopener"><code>Alembic</code></a>。它有一些限制：表名变化，字段名变化，匿名命名约束它是无法检测到。</p>
<p>通过下面命令可以将迁移应用到数据：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flask db upgrade</span><br></pre></td></tr></table></figure></p>
<p>每次迁移操作都应该添加进行版本控制中。</p>
<p>每次数据模型有变化，重复上面<code>migrate</code>和<code>upgrade</code>命令。</p>
<h3 id="Flask-Login"><a href="#Flask-Login" class="headerlink" title="Flask-Login"></a><a href="https://flask-login.readthedocs.io/en/latest/" target="_blank" rel="noopener">Flask-Login</a></h3><p><code>Flask-Login</code>为Flask提供用户会话管理，处理用户的登录，登出，登录状态判断。</p>
<p>它可以处理：</p>
<ul>
<li>会话中存储激活了的用户ID，让你登录或登出更简单。</li>
<li>让你限制登入（或登出）用户可以访问的视图。</li>
<li>处理棘手的<code>记住我</code>功能。</li>
<li>保护用户会话避免被盗。</li>
<li>可以于<code>Flask-Principal</code>或其它认证扩展集成。</li>
</ul>
<p>它无法处理：</p>
<ul>
<li>限制你使用特定的数据库或其它存储方法。如何加载用户完全由你决定。</li>
<li>限制你使用用户名和密码，OpenIDs，或者其它的认证方法。</li>
<li>处理超越 “登入或者登出” 之外的权限。</li>
<li>处理用户注册或者账号恢复。</li>
</ul>
<h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> pip install flask-login</span></span><br></pre></td></tr></table></figure>
<h4 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask_login <span class="keyword">import</span> LoginManager</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">login_manager.login_message = <span class="string">"You must be logged in to access this page."</span> <span class="comment">#登录提示文案</span></span><br><span class="line">login_manager.login_view = <span class="string">"auth.login"</span> <span class="comment">#登录视图函数</span></span><br><span class="line">login_manager = LoginManager() <span class="comment">#配置你的应用</span></span><br><span class="line">login_manager.init_app(app) <span class="comment">#将Flask-Login于你的应用绑定起来</span></span><br><span class="line">login_manager.session_protection = <span class="string">"strong"</span></span><br><span class="line"><span class="comment"># 获取存储的用户对象通过用户ID</span></span><br><span class="line"><span class="meta">@login_manager.user_loader</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_user</span><span class="params">(user_id)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> exampleModel.query.get(int(user_id))</span><br></pre></td></tr></table></figure>
<h4 id="保护视图-flask-ext-login-login-required-func-source"><a href="#保护视图-flask-ext-login-login-required-func-source" class="headerlink" title="保护视图  flask.ext.login.login_required(func)[source]"></a>保护视图  <a href="http://www.pythondoc.com/flask-login/#flask.ext.login.login_required" target="_blank" rel="noopener">flask.ext.login.login_required(func)[source]</a></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/post')</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>上面方法只有用户登录后才能调用。</p>
<h4 id="定制登录-Request-Loader"><a href="#定制登录-Request-Loader" class="headerlink" title="定制登录 Request Loader"></a>定制登录 <a href="http://flask-login.readthedocs.io/en/latest/#custom-login-using-request-loader" target="_blank" rel="noopener">Request Loader</a></h4><p>在调用接口时，我们需要将请求验证密钥，这密码一般放在请求头部。</p>
<p>通过<code>request_loader</code>方法我们可以创建一个解析请求头部信息方法。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@login_manager.request_loader</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_user_from_request</span><span class="params">(request)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># first, try to login using the api_key url arg</span></span><br><span class="line">    api_key = request.args.get(<span class="string">'api_key'</span>)</span><br><span class="line">    <span class="keyword">if</span> api_key:</span><br><span class="line">        user = User.query.filter_by(api_key=api_key).first()</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line">    <span class="comment"># next, try to login using Basic Auth</span></span><br><span class="line">    api_key = request.headers.get(<span class="string">'Authorization'</span>)</span><br><span class="line">    <span class="keyword">if</span> api_key:</span><br><span class="line">        api_key = api_key.replace(<span class="string">'Basic '</span>, <span class="string">''</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            api_key = base64.b64decode(api_key)</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        user = User.query.filter_by(api_key=api_key).first()</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            <span class="keyword">return</span> user</span><br><span class="line"></span><br><span class="line">    <span class="comment"># finally, return None if both methods did not login the user</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure></p>
<h4 id="记住我"><a href="#记住我" class="headerlink" title="记住我"></a>记住我</h4><p>当用户关闭浏览器后，会话就当结束。当打开网页用户需要重新登录才能获取到用户信息。通过<code>login_user(remeber= True)</code>[<a href="http://www.pythondoc.com/flask-login/#flask.ext.login.login_user]设置，当用户登录过一次后，会在用户计算机中存储一个cookie。当用户在打开网页时会读取cookie信息恢复用户ID。cookie是防篡改的，当用户改过它，它就会被拒绝。" target="_blank" rel="noopener">http://www.pythondoc.com/flask-login/#flask.ext.login.login_user]设置，当用户登录过一次后，会在用户计算机中存储一个cookie。当用户在打开网页时会读取cookie信息恢复用户ID。cookie是防篡改的，当用户改过它，它就会被拒绝。</a></p>
<h4 id="新鲜登录"><a href="#新鲜登录" class="headerlink" title="新鲜登录"></a>新鲜登录</h4><p>如果用户通过登录获取用户信息<code>Flask-Login</code>会将用户标记为<code>fresh</code>。如果是通过cookie获取到用户信息会被标记为<code>non-fresh</code>。</p>
<p><code>login-required</code>视<code>fresh</code>或<code>non-fresh</code>一样的效果。当如果有些操作比如:修改用户信息则应该只允许<code>fresh</code>操作，如果是<code>non-fresh</code>用户应该让他登录。</p>
<p><a href="http://flask-login.readthedocs.io/en/latest/#flask_login.fresh_login_required" target="_blank" rel="noopener"><code>fresh_login_required</code></a>装饰的方法只有<code>fresh</code>用户才能调用。<br><code>login_manager.refresh_view=&#39;auth.login&#39;</code>指定<code>non-fresh</code>登录视图方法。<br><code>login_manager.needs_refresh_message = (
    u&quot;To protect your account, please reauthenticate to access this page.&quot;
)</code>重新登录文案提示。</p>
<h4 id="会话保护"><a href="#会话保护" class="headerlink" title="会话保护"></a>会话保护</h4><p>你可以在 LoginManager 上和应用配置中配置会话保护。如果它被启用，它可以在 basic 或 strong 两种模式中运行。<code>要在 LoginManager</code> 上设置它，设置 <code>session_protection</code> 属性为 “basic” 或 “strong”:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">login_manager.session_protection = &quot;strong&quot; #None 、basic</span><br></pre></td></tr></table></figure><br>默认，它被激活为 “basic” 模式。它可以在应用配置中设定 SESSION_PROTECTION 为 None 、 “basic” 或 “strong” 来禁用。</p>
<p>当启用了会话保护，每个请求，它生成一个用户电脑的标识（基本上是 IP 地址和 User Agent 的 MD5 hash 值）。如果会话不包含相关的标识，则存储生成的。如果存在标识，则匹配生成的，之后请求可用。</p>
<p>在 basic 模式下或会话是永久的，如果该标识未匹配，会话会简单地被标记为非活 跃的，且任何需要活跃登入的东西会强制用户重新验证。（当然，你必须已经使用了活跃登入机制才能奏效。）</p>
<p>在 strong 模式下的非永久会话，如果该标识未匹配，整个会话（记住的令牌如果存在，则同样）被删除。</p>
<h3 id="Flask-Session"><a href="#Flask-Session" class="headerlink" title="Flask-Session"></a><a href="https://pythonhosted.org/Flask-Session/" target="_blank" rel="noopener">Flask-Session</a></h3><p>原生flask实用cookie签名保存session，而该插件支持将session保存到多个地方，如：redis、memcached、mongodb。</p>
<h4 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pip install flask-session</span><br></pre></td></tr></table></figure>
<h4 id="保存到redis"><a href="#保存到redis" class="headerlink" title="保存到redis"></a>保存到redis</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -</span></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session</span><br><span class="line"><span class="keyword">from</span> flask_session <span class="keyword">import</span> Session</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.debug = <span class="keyword">True</span></span><br><span class="line">app.secret_key = <span class="string">'xxxx'</span></span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SESSION_TYPE'</span>] = <span class="string">'redis'</span>  <span class="comment"># session类型为redis</span></span><br><span class="line">app.config[<span class="string">'SESSION_PERMANENT'</span>] = <span class="keyword">False</span>  <span class="comment"># 如果设置为True，则关闭浏览器session就失效。</span></span><br><span class="line">app.config[<span class="string">'SESSION_USE_SIGNER'</span>] = <span class="keyword">False</span>  <span class="comment"># 是否对发送到浏览器上session的cookie值进行加密</span></span><br><span class="line">app.config[<span class="string">'SESSION_KEY_PREFIX'</span>] = <span class="string">'sessionid'</span>  <span class="comment"># 保存到session中的值的前缀</span></span><br><span class="line">app.config[<span class="string">'SESSION_REDIS'</span>] = redis.Redis(host=<span class="string">'127.0.0.1'</span>, port=<span class="string">'6379'</span>, password=<span class="string">'123'</span>)  <span class="comment"># 用于连接redis的配置</span></span><br><span class="line"></span><br><span class="line">Session(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/index')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    session[<span class="string">'k1'</span>] = <span class="string">'v1'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'xx'</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>原文作者: </span>
      <a href="https://fynn90.github.io">Fynn</a>
    </p>
    <p class="copyright-item">
      <span>原文链接: </span>
      <a href="https://fynn90.github.io/2017/12/09/Flask介绍/">https://fynn90.github.io/2017/12/09/Flask介绍/</a>
    </p>
    <p class="copyright-item">
      <span>许可协议: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>



      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden />
    <label class="reward-button" for="reward">赞赏支持</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/wechat.png" title="wechat">
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/alipay.png" title="alipay">
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Flask/">Flask</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2017/12/12/Flask-SQLAlchemy/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Flask-SQLAlchemy</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    
    
      <a class="next" href="/2017/11/30/systemd-单元/">
        <span class="next-text nav-default">systemd-单元</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:fynn.90@outlook.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
        
          <a href="https://www.linkedin.com/in/%E5%B8%86-%E9%82%93-17163589/" class="iconfont icon-linkedin" title="linkedin"></a>
        
      
    
      
        
          <a href="https://plus.google.com/u/0/117459332873536225443" class="iconfont icon-google" title="google"></a>
        
      
    
      
        
          <a href="https://github.com/fynn90" class="iconfont icon-github" title="github"></a>
        
      
    
      
        
          <a href="http://www.weibo.com/306019091" class="iconfont icon-weibo" title="weibo"></a>
        
      
    
      
        
          <a href="https://www.zhihu.com/people/FynnDeng/activities" class="iconfont icon-zhihu" title="zhihu"></a>
        
      
    
      
    
      
    
      
    
    
    
  </div>


<div class="copyright">
  <span class="copyright-year">
    
    &copy; 
     
      2017 - 
    
    2020

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Fynn</span>
  </span>
  
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  
  

  



    
  





  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  
    <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>
